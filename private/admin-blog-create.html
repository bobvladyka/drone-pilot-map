<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ADMIN: Nov√Ω ƒçl√°nek (Quill) | NajdiPilota.cz</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  
  <style>
    :root {
      --primary: #0077B6;
      --secondary: #495057;
      --background-light: #F8F9FA;
    }
    body { background-color: #f0f2f5; font-family: 'Poppins', sans-serif; }
    .container { max-width: 950px; }
    .card { border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
    
    #editor-container {
        height: 500px;
        background: white;
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px;
    }

    /* Vzhled obsahu v editoru */
    .ql-editor {
        font-family: 'Poppins', 'Segoe UI', sans-serif;
        color: var(--secondary);
        font-size: 1.25rem;
        line-height: 1.6;
    }
    .ql-editor h1 { color: var(--primary); font-weight: 800; border-bottom: 3px solid #e9ecef; padding-bottom: 10px; margin-top: 2rem; }
    .ql-editor h2 { color: var(--secondary); font-weight: 700; margin-top: 2rem; padding-bottom: 6px; border-bottom: 2px solid #e9ecef; }
    .ql-editor h3 { color: var(--secondary); font-weight: 600; margin-top: 1.5rem; }
    .ql-editor a { color: var(--primary); text-decoration: none; font-weight: 500; }
    .ql-editor blockquote { border-left: 4px solid var(--primary); background: #f1f8ff; padding: 15px; color: #333; font-style: italic; }

    /* Styl pro rychl√° tlaƒç√≠tka */
    .quick-actions button { font-size: 0.85rem; font-weight: 500; }

    /* Nov√© styly pro tlaƒç√≠tka sd√≠len√≠ */
    .social-btn {
        transition: all 0.2s ease;
        font-size: 0.95rem;
    }
    
    .social-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .facebook-btn {
        background-color: #1877F2 !important;
        border: 1px solid #1877F2 !important;
    }
    
    .facebook-btn:hover {
        background-color: #166FE5 !important;
        border-color: #166FE5 !important;
    }
    
    .linkedin-btn {
        background-color: #0A66C2 !important;
        border: 1px solid #0A66C2 !important;
    }
    
    .linkedin-btn:hover {
        background-color: #004182 !important;
        border-color: #004182 !important;
    }
    
    .copy-btn {
        border: 1px solid #dee2e6 !important;
        color: #495057;
    }
    
    .copy-btn:hover {
        background-color: #e9ecef !important;
        border-color: #adb5bd !important;
    }
    
    /* Styly pro editor */
    .ql-editor .social-sharing-section {
        background-color: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
        border-left: 4px solid var(--primary);
    }
    
    .ql-editor .social-btn svg {
        flex-shrink: 0;
    }
  </style>
</head>

<body>

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-dark">‚ú® Nov√Ω blogov√Ω ƒçl√°nek</h2>
        <a href="/admin-blog-list.html" class="btn btn-outline-secondary">Zpƒõt na p≈ôehled</a>
    </div>
    
    <div class="card p-4">
        <form id="smartForm" enctype="multipart/form-data">
            
            <div class="mb-4">
                <label class="form-label fw-bold">Titulek ƒçl√°nku (H1)</label>
                <input type="text" class="form-control form-control-lg" id="inputTitle" name="title" required placeholder="Nap≈ô. Jak l√©tat s dronem v zimƒõ">
            </div>

            <div class="row">
                <div class="col-md-8 mb-3">
                    <label class="form-label small text-muted">Automatick√° URL (Slug)</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">/blogposts/</span>
                        <input type="text" class="form-control bg-light" id="inputSlug" name="slug" readonly required>
                        <span class="input-group-text bg-light">.html</span>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label fw-bold">Kategorie</label>
                    <select class="form-select" name="category">
                        <option value="Srovn√°n√≠">Srovn√°n√≠</option>
                        <option value="Tipy a triky">Tipy a triky</option>
                        <option value="Legislativa">Legislativa</option>
                        <option value="Novinky">Novinky</option>
                    </select>
                </div>
            </div>

            <div class="mb-4 p-3 bg-light rounded border border-dashed">
                <label class="form-label fw-bold">Hlavn√≠ obr√°zek</label>
                <input type="file" class="form-control" name="heroImage" accept="image/*" required>
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Meta Popis</label>
                <textarea class="form-control" name="description" rows="2" maxlength="160"></textarea>
            </div>

            <div class="mb-2 quick-actions p-2 bg-light rounded border d-flex gap-2 align-items-center flex-wrap">
                <span class="fw-bold small text-muted text-uppercase me-2">‚ö° Rychl√© vlo≈æen√≠:</span>
                
                <button type="button" class="btn btn-sm btn-white border shadow-sm" onclick="insertMapLink()">
                    üåç Odkaz na Mapu
                </button>
                
                <button type="button" class="btn btn-sm btn-white border shadow-sm" onclick="insertRegisterPilotLink()">
                    üë®‚Äç‚úàÔ∏è Reg. Pilota
                </button>

                <button type="button" class="btn btn-sm btn-white border shadow-sm" onclick="insertRegisterAdvertiserLink()">
                    üíº Reg. Inzerenta
                </button>
                
                <button type="button" class="btn btn-sm btn-success text-white shadow-sm" onclick="insertCTA()">
                    üîò Tlaƒç√≠tko "Naj√≠t Pilota"
                </button>
                
                <button type="button" class="btn btn-sm btn-info text-white shadow-sm" onclick="insertInfoBox()">
                    üí° Info Box
                </button>

                <button type="button" class="btn btn-sm btn-white border shadow-sm" onclick="insertSocialButtons()">
                    üì± Tlaƒç√≠tka sd√≠len√≠
                </button>
            </div>

            <div class="mb-4">
                <div id="editor-container"></div>
                <input type="hidden" name="bodyHtml" id="hiddenBodyHtml">
            </div>

<!-- ‚úÖ STAV PUBLIKACE -->
<div class="mb-3">
  <label class="form-label fw-bold">Stav ƒçl√°nku</label>
  <select name="status" class="form-select">
    <option value="published">üöÄ Publikovat hned</option>
    <option value="scheduled">üïí Napl√°novat</option>
    <option value="draft">üìù Ulo≈æit jako koncept</option>
  </select>
</div>

<!-- ‚úÖ DATUM PUBLIKACE -->
<div class="mb-3">
  <label class="form-label fw-bold">Datum publikace (pro pl√°nov√°n√≠)</label>
  <input type="datetime-local" name="publishAt" class="form-control">
</div>


            <input type="hidden" name="author" value="T√Ωm NajdiPilota">

            <button type="submit" class="btn btn-primary btn-lg w-100 py-3 fw-bold">üöÄ Publikovat ƒçl√°nek</button>
        </form>
    </div>
</div>

<div class="modal fade" id="resultModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-body" id="modalBody"></div><div class="modal-footer"><button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button></div></div></div></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
    // 1. Nastaven√≠ Quillu
    var quill = new Quill('#editor-container', {
        theme: 'snow',
        placeholder: 'Zde napi≈°te sv≈Øj ƒçl√°nek...',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, false] }], 
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['link', 'image', 'video'],
                ['blockquote'],
                ['clean']
            ]
        }
    });

    // 2. Funkce pro rychl√© vlo≈æen√≠ (SEO Shortcuts)
    function insertHtmlAtCursor(html) {
        const range = quill.getSelection(true);
        if (range) {
            quill.clipboard.dangerouslyPasteHTML(range.index, html);
        } else {
            // Pokud nen√≠ kurzor v editoru, vlo≈æ√≠ na konec
            const length = quill.getLength();
            quill.clipboard.dangerouslyPasteHTML(length - 1, html);
        }
    }

    function insertMapLink() {
        insertHtmlAtCursor(' <a href="/index.html" title="Mapa pilot≈Ø dron≈Ø">mapƒõ pilot≈Ø NajdiPilota.cz</a> ');
    }

    function insertRegisterPilotLink() {
        insertHtmlAtCursor(' <a href="/register.html" title="Registrace pilota dronu">registrujte se jako pilot</a> ');
    }

    function insertRegisterAdvertiserLink() {
        insertHtmlAtCursor(' <a href="/inzerent-register.html" title="Registrace pro zad√°v√°n√≠ popt√°vek">zaregistrujte se jako inzerent</a> ');
    }

    function insertCTA() {
        // Vlo≈æ√≠ v√Ωrazn√© tlaƒç√≠tko
        const btnHtml = `<p style="text-align: center; margin: 30px 0;"><a href="/index.html" style="background-color: #0077B6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 18px;">üöÅ Naj√≠t pilota ve va≈°em okol√≠</a></p><p><br></p>`;
        insertHtmlAtCursor(btnHtml);
    }

    function insertInfoBox() {
        const boxHtml = `<blockquote style="border-left: 4px solid #0077B6; background: #f1f8ff; padding: 15px; color: #333;"><strong>üí° Tip:</strong> Zde napi≈°te sv≈Øj tip pro ƒçten√°≈ôe...</blockquote><p><br></p>`;
        insertHtmlAtCursor(boxHtml);
    }

    // 3. Funkce pro tlaƒç√≠tka sd√≠len√≠ (JEDIN√Å verze)
    function insertSocialButtons() {
        const exampleSlug = document.getElementById('inputSlug').value || 'priklad-clanek';
        const exampleTitle = document.getElementById('inputTitle').value || 'N√°zev ƒçl√°nku';
        
        const relativeUrl = `/blogposts/${exampleSlug}.html`;
        const safeTitle = exampleTitle.replace(/"/g, '&quot;');
        
        const socialHtml = `
<div class="social-sharing-section mt-5 pt-4 border-top">
    <p class="fw-bold mb-3 text-dark">üì¢ Sd√≠lejte tento ƒçl√°nek:</p>
    <div class="d-flex gap-3 flex-wrap align-items-center">
        <!-- Facebook Button -->
        <a href="#" 
           data-share-type="facebook"
           data-url="${relativeUrl}"
           data-title="${safeTitle}"
           class="social-btn facebook-btn d-flex align-items-center gap-2 px-4 py-2 rounded-3 text-white text-decoration-none fw-medium">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
                <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
            </svg>
            Sd√≠let na Facebooku
        </a>
        
        <!-- LinkedIn Button -->
        <a href="#" 
           data-share-type="linkedin"
           data-url="${relativeUrl}"
           class="social-btn linkedin-btn d-flex align-items-center gap-2 px-4 py-2 rounded-3 text-white text-decoration-none fw-medium">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16">
                <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.432.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/>
            </svg>
            Sd√≠let na LinkedIn
        </a>
        
        <!-- Kop√≠rov√°n√≠ odkazu -->
        <button type="button" 
                class="social-btn copy-btn d-flex align-items-center gap-2 px-4 py-2 rounded-3 bg-light border text-decoration-none fw-medium"
                data-copy-url="${relativeUrl}">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
                <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"/>
                <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 0 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 0 0-4.243-4.243z"/>
            </svg>
            Kop√≠rovat odkaz
        </button>
    </div>
    <small class="text-muted mt-2 d-block">Kliknut√≠m otev≈ôete sd√≠lec√≠ okno v nov√© z√°lo≈æce</small>
</div>
<p><br></p>`;
        
        insertHtmlAtCursor(socialHtml);
        // P≈ôid√°me event listenery pro tlaƒç√≠tka v editoru
        setTimeout(attachShareButtonListeners, 100);
    }

    // 4. Funkce pro spr√°vu tlaƒç√≠tek sd√≠len√≠
    function attachShareButtonListeners() {
        // Facebook tlaƒç√≠tka
        document.querySelectorAll('[data-share-type="facebook"]').forEach(btn => {
            // Odstranit existuj√≠c√≠ listenery
            btn.replaceWith(btn.cloneNode(true));
        });
        
        document.querySelectorAll('[data-share-type="facebook"]').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const url = this.getAttribute('data-url');
                const title = this.getAttribute('data-title') || document.title;
                const fullUrl = window.location.origin + url;
                const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(fullUrl)}&quote=${encodeURIComponent(title)}`;
                window.open(shareUrl, '_blank', 'width=600,height=400');
            });
        });
        
        // LinkedIn tlaƒç√≠tka
        document.querySelectorAll('[data-share-type="linkedin"]').forEach(btn => {
            btn.replaceWith(btn.cloneNode(true));
        });
        
        document.querySelectorAll('[data-share-type="linkedin"]').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const url = this.getAttribute('data-url');
                const fullUrl = window.location.origin + url;
                const shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(fullUrl)}`;
                window.open(shareUrl, '_blank', 'width=600,height=400');
            });
        });
        
        // Kop√≠rov√°n√≠ tlaƒç√≠tka
        document.querySelectorAll('[data-copy-url]').forEach(btn => {
            btn.replaceWith(btn.cloneNode(true));
        });
        
        document.querySelectorAll('[data-copy-url]').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const url = this.getAttribute('data-copy-url');
                const fullUrl = window.location.origin + url;
                copyToClipboard(fullUrl, this);
            });
        });
    }

    // 5. Funkce pro kop√≠rov√°n√≠ do schr√°nky
    function copyToClipboard(text, buttonElement) {
        navigator.clipboard.writeText(text).then(() => {
            const btn = buttonElement;
            const originalHTML = btn.innerHTML;
            const originalClasses = btn.className;
            
            btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check" viewBox="0 0 16 16"><path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/></svg> Odkaz zkop√≠rov√°n!';
            btn.className = originalClasses.replace('bg-light', '') + ' bg-success text-white border-success';
            
            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.className = originalClasses;
            }, 2000);
        }).catch(err => {
            console.error('Chyba p≈ôi kop√≠rov√°n√≠: ', err);
            alert('Nepoda≈ôilo se zkop√≠rovat odkaz. Zkuste to pros√≠m ruƒçnƒõ.');
        });
    }

    // 6. Auto Slug
    const titleInput = document.getElementById('inputTitle');
    const slugInput = document.getElementById('inputSlug');
    titleInput.addEventListener('input', function() {
        const date = new Date().toISOString().slice(0, 10).replace(/-/g, ""); 
        let safeTitle = this.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9\s-]/g, '').trim().replace(/\s+/g, '-');
        slugInput.value = `${date}-${safeTitle}`;
    });

    // 7. Odesl√°n√≠
    document.getElementById('smartForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        document.getElementById('hiddenBodyHtml').value = quill.root.innerHTML;
        const formData = new FormData(this);
        const modal = new bootstrap.Modal(document.getElementById('resultModal'));
        const modalBody = document.getElementById('modalBody');

        try {
            const res = await fetch('/api/admin/create-blog-post', { method: 'POST', body: formData });
            const result = await res.json();
            if (res.ok) {
                modalBody.innerHTML = `<div class="text-success text-center"><h3>‚úÖ Hotovo!</h3><p>ƒål√°nek vytvo≈ôen.</p><a href="${result.url}" target="_blank" class="btn btn-success">Zobrazit</a></div>`;
                this.reset(); quill.setContents([]);
            } else throw new Error(result.error);
        } catch (err) { modalBody.innerHTML = `<div class="text-danger">‚ùå Chyba: ${err.message}</div>`; }
        modal.show();
    });

    // 8. Inicializace listener≈Ø p≈ôi naƒçten√≠ str√°nky
    document.addEventListener('DOMContentLoaded', function() {
        attachShareButtonListeners();
    });
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const statusSelect = document.querySelector('select[name="status"]');
  const dateInput = document.querySelector('input[name="publishAt"]');

  function togglePublishDate() {
    if (statusSelect.value === 'scheduled') {
      dateInput.disabled = false;
    } else {
      dateInput.disabled = true;
      dateInput.value = "";
    }
  }

  statusSelect.addEventListener('change', togglePublishDate);
  togglePublishDate(); // ‚úÖ zavol√° se hned p≈ôi naƒçten√≠
});
</script>


</body>
</html>