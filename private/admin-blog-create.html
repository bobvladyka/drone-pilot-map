<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ADMIN: Nov√Ω ƒçl√°nek (Quill) | NajdiPilota.cz</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  
  <style>
    :root {
      --primary: #0077B6;
      --secondary: #495057;
      --background-light: #F8F9FA;
    }
    body { background-color: #f0f2f5; font-family: 'Poppins', sans-serif; }
    .container { max-width: 950px; }
    .card { border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
    
    #editor-container {
        height: 500px;
        background: white;
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px;
    }

    /* Vzhled obsahu v editoru */
    .ql-editor {
        font-family: 'Poppins', 'Segoe UI', sans-serif;
        color: var(--secondary);
        font-size: 1.25rem;
        line-height: 1.6;
    }
    .ql-editor h1 { color: var(--primary); font-weight: 800; border-bottom: 3px solid #e9ecef; padding-bottom: 10px; margin-top: 2rem; }
    .ql-editor h2 { color: var(--secondary); font-weight: 700; margin-top: 2rem; padding-bottom: 6px; border-bottom: 2px solid #e9ecef; }
    .ql-editor h3 { color: var(--secondary); font-weight: 600; margin-top: 1.5rem; }
    .ql-editor a { color: var(--primary); text-decoration: none; font-weight: 500; }
    .ql-editor blockquote { border-left: 4px solid var(--primary); background: #f1f8ff; padding: 15px; color: #333; font-style: italic; }

    /* Styl pro rychl√° tlaƒç√≠tka */
    .quick-actions button { font-size: 0.85rem; font-weight: 500; }
  </style>
</head>

<body>

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-dark">‚ú® Nov√Ω blogov√Ω ƒçl√°nek</h2>
        <a href="/admin.html" class="btn btn-outline-secondary">Zpƒõt do menu</a>
    </div>
    
    <div class="card p-4">
        <form id="smartForm" enctype="multipart/form-data">
            
            <div class="mb-4">
                <label class="form-label fw-bold">Titulek ƒçl√°nku (H1)</label>
                <input type="text" class="form-control form-control-lg" id="inputTitle" name="title" required placeholder="Nap≈ô. Jak l√©tat s dronem v zimƒõ">
            </div>

            <div class="row">
                <div class="col-md-8 mb-3">
                    <label class="form-label small text-muted">Automatick√° URL (Slug)</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light">/blogposts/</span>
                        <input type="text" class="form-control bg-light" id="inputSlug" name="slug" readonly required>
                        <span class="input-group-text bg-light">.html</span>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label fw-bold">Kategorie</label>
                    <select class="form-select" name="category">
                        <option value="Srovn√°n√≠">Srovn√°n√≠</option>
                        <option value="Tipy a triky">Tipy a triky</option>
                        <option value="Legislativa">Legislativa</option>
                        <option value="Novinky">Novinky</option>
                    </select>
                </div>
            </div>

            <div class="mb-4 p-3 bg-light rounded border border-dashed">
                <label class="form-label fw-bold">Hlavn√≠ obr√°zek</label>
                <input type="file" class="form-control" name="heroImage" accept="image/*" required>
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Meta Popis</label>
                <textarea class="form-control" name="description" rows="2" maxlength="160"></textarea>
            </div>

            <div class="mb-2 quick-actions p-2 bg-light rounded border d-flex gap-2 align-items-center flex-wrap">
                <span class="fw-bold small text-muted text-uppercase me-2">‚ö° Rychl√© vlo≈æen√≠:</span>
                
                <button type="button" class="btn btn-sm btn-white border shadow-sm" onclick="insertMapLink()">
                    üåç Odkaz na Mapu
                </button>
                
                <button type="button" class="btn btn-sm btn-white border shadow-sm" onclick="insertRegisterPilotLink()">
                    üë®‚Äç‚úàÔ∏è Reg. Pilota
                </button>

                <button type="button" class="btn btn-sm btn-white border shadow-sm" onclick="insertRegisterAdvertiserLink()">
                    üíº Reg. Inzerenta
                </button>
                
                <button type="button" class="btn btn-sm btn-success text-white shadow-sm" onclick="insertCTA()">
                    üîò Tlaƒç√≠tko "Naj√≠t Pilota"
                </button>
                
                <button type="button" class="btn btn-sm btn-info text-white shadow-sm" onclick="insertInfoBox()">
                    üí° Info Box
                </button>
            </div>

            <div class="mb-4">
                <div id="editor-container"></div>
                <input type="hidden" name="bodyHtml" id="hiddenBodyHtml">
            </div>

            <input type="hidden" name="author" value="T√Ωm NajdiPilota">

            <button type="submit" class="btn btn-primary btn-lg w-100 py-3 fw-bold">üöÄ Publikovat ƒçl√°nek</button>
        </form>
    </div>
</div>

<div class="modal fade" id="resultModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-body" id="modalBody"></div><div class="modal-footer"><button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button></div></div></div></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
    // 1. Nastaven√≠ Quillu
    var quill = new Quill('#editor-container', {
        theme: 'snow',
        placeholder: 'Zde napi≈°te sv≈Øj ƒçl√°nek...',
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, false] }], 
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['link', 'image', 'video'],
                ['blockquote'],
                ['clean']
            ]
        }
    });

    // 2. Funkce pro rychl√© vlo≈æen√≠ (SEO Shortcuts)
    function insertHtmlAtCursor(html) {
        const range = quill.getSelection(true);
        if (range) {
            quill.clipboard.dangerouslyPasteHTML(range.index, html);
        } else {
            // Pokud nen√≠ kurzor v editoru, vlo≈æ√≠ na konec
            const length = quill.getLength();
            quill.clipboard.dangerouslyPasteHTML(length - 1, html);
        }
    }

    function insertMapLink() {
        insertHtmlAtCursor(' <a href="/index.html" title="Mapa pilot≈Ø dron≈Ø">mapƒõ pilot≈Ø NajdiPilota.cz</a> ');
    }

    function insertRegisterPilotLink() {
        insertHtmlAtCursor(' <a href="/register.html" title="Registrace pilota dronu">registrujte se jako pilot</a> ');
    }

    function insertRegisterAdvertiserLink() {
        insertHtmlAtCursor(' <a href="/inzerent-register.html" title="Registrace pro zad√°v√°n√≠ popt√°vek">zaregistrujte se jako inzerent</a> ');
    }

    function insertCTA() {
        // Vlo≈æ√≠ v√Ωrazn√© tlaƒç√≠tko
        const btnHtml = `<p style="text-align: center; margin: 30px 0;"><a href="/index.html" style="background-color: #0077B6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 18px;">üöÅ Naj√≠t pilota ve va≈°em okol√≠</a></p><p><br></p>`;
        insertHtmlAtCursor(btnHtml);
    }

    function insertInfoBox() {
        const boxHtml = `<blockquote style="border-left: 4px solid #0077B6; background: #f1f8ff; padding: 15px; color: #333;"><strong>üí° Tip:</strong> Zde napi≈°te sv≈Øj tip pro ƒçten√°≈ôe...</blockquote><p><br></p>`;
        insertHtmlAtCursor(boxHtml);
    }

    // 3. Auto Slug
    const titleInput = document.getElementById('inputTitle');
    const slugInput = document.getElementById('inputSlug');
    titleInput.addEventListener('input', function() {
        const date = new Date().toISOString().slice(0, 10).replace(/-/g, ""); 
        let safeTitle = this.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9\s-]/g, '').trim().replace(/\s+/g, '-');
        slugInput.value = `${date}-${safeTitle}`;
    });

    // 4. Odesl√°n√≠
    document.getElementById('smartForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        document.getElementById('hiddenBodyHtml').value = quill.root.innerHTML;
        const formData = new FormData(this);
        const modal = new bootstrap.Modal(document.getElementById('resultModal'));
        const modalBody = document.getElementById('modalBody');

        try {
            const res = await fetch('/api/admin/create-blog-post', { method: 'POST', body: formData });
            const result = await res.json();
            if (res.ok) {
                modalBody.innerHTML = `<div class="text-success text-center"><h3>‚úÖ Hotovo!</h3><p>ƒål√°nek vytvo≈ôen.</p><a href="${result.url}" target="_blank" class="btn btn-success">Zobrazit</a></div>`;
                this.reset(); quill.setContents([]);
            } else throw new Error(result.error);
        } catch (err) { modalBody.innerHTML = `<div class="text-danger">‚ùå Chyba: ${err.message}</div>`; }
        modal.show();
    });
</script>

</body>
</html>