<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>ADMIN â€“ PÅ™ehled ÄlÃ¡nkÅ¯ | NajdiPilota.cz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f0f2f5;
      font-family: 'Poppins', sans-serif;
    }
    .container {
      max-width: 1100px;
    }
    .status-badge {
      font-size: 0.85rem;
      padding: 6px 12px;
      border-radius: 20px;
    }
    .status-published { background: #d1fae5; color: #065f46; }
    .status-scheduled { background: #dbeafe; color: #1e40af; }
    .status-draft { background: #fef3c7; color: #92400e; }
  </style>
</head>

<body>

<div class="container py-5">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">ğŸ›  PÅ™ehled blogovÃ½ch ÄlÃ¡nkÅ¯</h2>
    <div>
      <a href="/admin.html" class="btn btn-outline-secondary me-2">â† ZpÄ›t do menu</a>
      <a href="/admin-blog-create.html" class="btn btn-primary">+ NovÃ½ ÄlÃ¡nek</a>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-striped align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Titulek</th>
            <th>Stav</th>
            <th>Publikace</th>
            <th class="text-end">Akce</th>
          </tr>
        </thead>
        <tbody id="blogRows">
          <tr>
            <td colspan="4" class="text-center text-muted p-4">NaÄÃ­tÃ¡m ÄlÃ¡nky...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
async function loadPosts() {
  const tbody = document.getElementById("blogRows");
  tbody.innerHTML = `<tr><td colspan="4" class="text-center text-muted p-4">NaÄÃ­tÃ¡m ÄlÃ¡nky...</td></tr>`;

  const res = await fetch("/api/admin/blog-list");
  const posts = await res.json();

  if (!posts.length) {
    tbody.innerHTML = `<tr><td colspan="4" class="text-center p-4">Å½Ã¡dnÃ© ÄlÃ¡nky</td></tr>`;
    return;
  }

  tbody.innerHTML = "";

  posts
    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
    .forEach(p => {
      const statusClass =
        p.status === "published" ? "status-published" :
        p.status === "scheduled" ? "status-scheduled" :
        "status-draft";

      tbody.innerHTML += `
        <tr>
          <td>
            <strong>${p.title}</strong><br>
            <small class="text-muted">${p.slug}</small>
          </td>

          <td>
            <span class="status-badge ${statusClass}">
              ${p.status}
            </span>
          </td>

          <td>
            ${p.publishAt ? new Date(p.publishAt).toLocaleString("cs-CZ") : "-"}
          </td>

          <td class="text-end">

  <a href="/admin-blog-edit.html?slug=${p.slug}"
     class="btn btn-sm btn-warning me-1">
    âœï¸ Upravit
  </a>

  ${p.status !== "published" ? `
    <button class="btn btn-sm btn-success me-1" onclick="publishNow('${p.slug}')">
      ğŸš€ Publikovat
    </button>
  ` : `
    <a href="/blogposts/${p.slug}.html" target="_blank"
       class="btn btn-sm btn-outline-primary me-1">
      ğŸ‘ NÃ¡hled
    </a>
  `}

  <button class="btn btn-sm btn-outline-danger"
          onclick="deletePost('${p.slug}')">
    ğŸ—‘ Smazat
  </button>
</td>

        </tr>
      `;
    });
}

async function publishNow(slug) {
  if (!confirm("Publikovat ÄlÃ¡nek hned?")) return;

  await fetch(`/api/admin/publish/${slug}`, { method: "POST" });
  loadPosts();
}

async function deletePost(slug) {
  if (!confirm("Opravdu smazat tento ÄlÃ¡nek?")) return;

  await fetch(`/api/admin/delete/${slug}`, { method: "DELETE" });
  loadPosts();
}

loadPosts();
</script>

</body>
</html>
