<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>M≈Øj √∫ƒçet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container py-5">
    <h1 class="text-center mb-4">üßë‚Äç‚úàÔ∏è √öƒçet pilota</h1>
    <form id="account-form" class="row g-3">
      <input type="hidden" id="id" name="id">

      <div class="col-md-6">
        <label class="form-label">Jm√©no:</label>
        <input type="text" id="name" name="name" class="form-control" required>
      </div>

      <div class="col-md-6">
        <label class="form-label">E-mail:</label>
        <input type="email" id="email" name="email" class="form-control" required readonly>
      </div>

      <div class="col-md-6">
        <label class="form-label">Telefon:</label>
        <input type="tel" id="phone" name="phone" class="form-control">
      </div>

      <div class="col-md-6">
        <label class="form-label">Web:</label>
        <input type="url" id="website" name="website" class="form-control">
      </div>

      <div class="col-md-4">
        <label class="form-label">Ulice:</label>
        <input type="text" id="street" name="street" class="form-control">
      </div>

      <div class="col-md-4">
        <label class="form-label">Mƒõsto:</label>
        <input type="text" id="city" name="city" class="form-control">
      </div>

      <div class="col-md-4">
        <label class="form-label">PSƒå:</label>
        <input type="text" id="zip" name="zip" class="form-control">
      </div>

      <div class="col-12">
        <label for="region" class="form-label">Kraj:</label>
        <select id="region" name="region" class="form-select">
          <option value="">‚Äì Vyber kraj ‚Äì</option>
          <option value="Hlavn√≠ mƒõsto Praha">Hlavn√≠ mƒõsto Praha</option>
          <option value="St≈ôedoƒçesk√Ω kraj">St≈ôedoƒçesk√Ω kraj</option>
          <option value="Jihoƒçesk√Ω kraj">Jihoƒçesk√Ω kraj</option>
          <option value="Plze≈àsk√Ω kraj">Plze≈àsk√Ω kraj</option>
          <option value="Karlovarsk√Ω kraj">Karlovarsk√Ω kraj</option>
          <option value="√östeck√Ω kraj">√östeck√Ω kraj</option>
          <option value="Libereck√Ω kraj">Libereck√Ω kraj</option>
          <option value="Kr√°lov√©hradeck√Ω kraj">Kr√°lov√©hradeck√Ω kraj</option>
          <option value="Pardubick√Ω kraj">Pardubick√Ω kraj</option>
          <option value="Kraj Vysoƒçina">Kraj Vysoƒçina</option>
          <option value="Jihomoravsk√Ω kraj">Jihomoravsk√Ω kraj</option>
          <option value="Olomouck√Ω kraj">Olomouck√Ω kraj</option>
          <option value="Zl√≠nsk√Ω kraj">Zl√≠nsk√Ω kraj</option>
          <option value="Moravskoslezsk√Ω kraj">Moravskoslezsk√Ω kraj</option>
        </select>
      </div>

      <div class="col-12">
        <label class="form-label">Povolen√≠ (licence):</label><br>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="licenses" value="OPEN A1/A3" id="a1a3">
          <label class="form-check-label" for="a1a3">A1/A3</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="licenses" value="OPEN A2" id="a2">
          <label class="form-check-label" for="a2">A2</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="licenses" value="LUC" id="luc">
          <label class="form-check-label" for="luc">LUC</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="licenses" value="SPECIFIC" id="specific">
          <label class="form-check-label" for="specific">SPECIFIC</label>
        </div>
      </div>

      <div class="col-md-6">
        <label class="form-label">Drony ve vlastnictv√≠:</label>
        <input type="text" id="drones" name="drones" class="form-control">
      </div>

      <div class="col-md-6">
        <label class="form-label">Ochota doj√≠≈ædƒõt:</label>
        <select id="travel" name="travel" class="form-select">
          <option value="">‚Äì Vyber ‚Äì</option>
          <option value="ANO">ANO</option>
          <option value="NE">NE</option>
        </select>
      </div>

      <div class="col-12">
        <label class="form-label">Specializace:</label>
        <select id="specialization" name="specialization" multiple class="form-select">
          <option value="Foto/video">Foto/video</option>
          <option value="Fotogrammetrie">Fotogrammetrie</option>
          <option value="Senoseƒç">Senoseƒç</option>
          <option value="Term√°ln√≠ inspekce">Term√°ln√≠ inspekce</option>
          <option value="FPV pr≈Ølety">FPV pr≈Ølety</option>
          <option value="Jin√©">Jin√© (v√≠ce v pozn√°mce)</option>
        </select>
      </div>

      <div class="col-12">
        <label class="form-label">Pozn√°mka:</label>
        <textarea id="note" name="note" rows="3" class="form-control"></textarea>
      </div>

      <div class="col-12">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="volunteer" name="volunteer" value="ANO">
          <label class="form-check-label" for="volunteer">Dobrovoln√≠k</label>
        </div>
      </div>

      <div class="col-12">
        <button type="submit" class="btn btn-success w-100">üíæ Ulo≈æit zmƒõny</button>
        <p id="status" class="mt-3 text-center fw-semibold"></p>
        <div class="text-center mt-3">
          <a href="/index.html" class="btn btn-link">‚Üê Zpƒõt na mapu</a>
        </div>
      </div>
    </form>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const email = params.get("email");
    const status = document.getElementById("status");

    fetch("/pilots")
      .then(res => res.json())
      .then(data => {
        const pilot = data.find(p => p.email === email);
        if (!pilot) {
          status.textContent = "Pilot nenalezen.";
          status.classList.add("text-danger");
          return;
        }

        document.getElementById("id").value = pilot.id || "";
        document.getElementById("name").value = pilot.name || "";
        document.getElementById("email").value = pilot.email || "";
        document.getElementById("phone").value = pilot.phone || "";
        document.getElementById("website").value = pilot.website || "";
        document.getElementById("street").value = pilot.street || "";
        document.getElementById("city").value = pilot.city || "";
        document.getElementById("zip").value = pilot.zip || "";
        document.getElementById("region").value = pilot.region || "";
        document.getElementById("drones").value = pilot.drones || "";
        document.getElementById("note").value = pilot.note || "";
        document.getElementById("travel").value = pilot.travel || "";

        const licenses = (pilot.licenses || "").split(",").map(s => s.trim());
        document.querySelectorAll("input[name='licenses']").forEach(cb => {
          cb.checked = licenses.includes(cb.value);
        });

        if (pilot.specialization) {
          const specializations = pilot.specialization.split(',').map(s => s.trim());
          [...document.getElementById("specialization").options].forEach(opt => {
            opt.selected = specializations.includes(opt.value);
          });
        }

        if (pilot.volunteer === "ANO") {
          document.getElementById("volunteer").checked = true;
        }
      });

    document.getElementById("account-form").addEventListener("submit", async e => {
      e.preventDefault();

      const data = {
        id: document.getElementById("id").value,
        email: document.getElementById("email").value,
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        website: document.getElementById("website").value,
        street: document.getElementById("street").value,
        city: document.getElementById("city").value,
        zip: document.getElementById("zip").value,
        region: document.getElementById("region").value,
        drones: document.getElementById("drones").value,
        note: document.getElementById("note").value,
        travel: document.getElementById("travel").value,
        licenses: Array.from(document.querySelectorAll("input[name='licenses']:checked")).map(cb => cb.value).join(", "),
        specialization: Array.from(document.getElementById("specialization").selectedOptions).map(o => o.value).join(", "),
        volunteer: document.getElementById("volunteer").checked ? "ANO" : "NE"
      };

      const res = await fetch("/update", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const text = await res.text();
      status.textContent = text;
      status.classList.remove("text-danger", "text-success");
      status.classList.add(res.ok ? "text-success" : "text-danger");
    });
  </script>
</body>
</html>
