<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Admin ‚Äì Spr√°va pilot≈Ø</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <style>
    .edit-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .edit-btn:hover {
      background-color: #45a049;
    }
    #form-wrapper {
      max-height: 80vh;
      overflow-y: auto;
      padding: 20px;
      background: #f5f5f5;
      border-radius: 5px;
      margin-top: 20px;
    }
    #form-wrapper form {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
    }
    #form-wrapper label {
      display: block;
      margin-bottom: 5px;
    }
    #form-wrapper input,
    #form-wrapper select,
    #form-wrapper textarea {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <h1>Admin ‚Äì Spr√°va pilot≈Ø</h1>

  <button onclick="deleteAll()">üóëÔ∏è Smazat v≈°echny z√°znamy</button>
  <button onclick="deleteSelected()">üóëÔ∏è Odstranit vybran√©</button>

  <p id="status"></p>

  <table>
    <thead>
      <tr>
        <th><input type="checkbox" onclick="toggleAll(this)"></th>
        <th>ID</th>
        <th>Jm√©no</th>
        <th>Mƒõsto</th>
        <th>Kraj</th>
        <th>E-mail</th>
        <th>Dostupn√Ω</th>
        <th>Viditeln√Ω</th>
        <th>Platnost viditelnosti</th>
        <th>Akce</th>
      </tr>
    </thead>
    <tbody id="pilot-table"></tbody>
  </table>

  <div id="form-wrapper" style="display:none;">
    <h3>√öprava pilota</h3>
    <form onsubmit="submitForm(event)">
      <input type="hidden" id="id" />
      
      <label>Jm√©no: <input id="name" required /></label>
      <label>Lokace: <input id="location" /></label>
      <label>E-mail: <input id="email" type="email" required /></label>
      <label>Telefon: <input id="phone" /></label>
      <label>Pozn√°mka: <textarea id="note"></textarea></label>
      <label>Zemƒõpisn√° ≈°√≠≈ôka: <input id="latitude" type="number" step="0.000001" /></label>
      <label>Zemƒõpisn√° d√©lka: <input id="longitude" type="number" step="0.000001" /></label>
      <label>Heslo (hash): <input id="password_hash" /></label>
      <label>Web: <input id="website" type="url" /></label>
      <label>Mƒõsto: <input id="city" /></label>
      <label>Ulice: <input id="street" /></label>
      <label>PSƒå: <input id="zip" /></label>
      <label>Kraj: <input id="region" /></label>
      <label>Licence: <textarea id="licenses"></textarea></label>
      <label>Drony: <textarea id="drones"></textarea></label>
      <label>Ochota doj√≠≈ædƒõt:
        <select id="travel">
          <option value="">-- Vyber --</option>
          <option value="ANO">ANO</option>
          <option value="NE">NE</option>
        </select>
      </label>
      <label>Specializace: <input id="specialization" /></label>
      <label>Dobrovoln√≠k:
        <select id="volunteer">
          <option value="">-- Vyber --</option>
          <option value="ANO">ANO</option>
          <option value="NE">NE</option>
        </select>
      </label>
      <label>Registraƒçn√≠ ƒç√≠slo: <input id="registrationnumber" /></label>
      <label>Dostupn√Ω:
        <select id="available">
          <option value="">-- Vyber --</option>
          <option value="ANO">ANO</option>
          <option value="NE">NE</option>
        </select>
      </label>

      <label>Viditeln√Ω na mapƒõ:
  <select id="visible" name="visible">
    <option value="NE">NE</option>
    <option value="ANO">ANO</option>
  </select>
</label>

<label>Stav platby za viditelnost:
  <select id="visible_payment" name="visible_payment">
    <option value="NE">NE</option>
    <option value="ANO">ANO</option>
  </select>
</label>

<label>Platn√© do (datum):
  <input type="date" id="visible_valid" name="visible_valid">
</label>
      
      <div style="grid-column: 1 / -1;">
        <button type="submit" class="edit-btn">üíæ Ulo≈æit zmƒõny</button>
        <button type="button" onclick="document.getElementById('form-wrapper').style.display='none'" style="margin-left:10px;">Zru≈°it</button>
      </div>
    </form>
  </div>

  <script>
    let editingId = null;

    function loadPilots() {
      fetch('/pilots')
        .then(res => res.json())
        .then(data => {
          const table = document.getElementById('pilot-table');
          table.innerHTML = '';
          data.forEach(p => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td><input type="checkbox" class="row-checkbox" value="${p.id}" /></td>
              <td>${p.id}</td>
              <td>${p.name || ''}</td>
              <td>${p.city || ''}</td>
              <td>${p.region || ''}</td>
              <td>${p.email || ''}</td>
              <td>${p.available || 'NE'}</td>
              <td>${p.visible || 'NE'}</td>
              <td>${p.visible_valid || '---'}</td>
              <td>
                <button class="edit-btn" onclick='edit(${JSON.stringify(p).replace(/'/g, "\\'")})'>
                  Upravit
                </button>
              </td>
            `;
            table.appendChild(row);
          });
        });
    }

    

    function edit(p) {
      editingId = p.id;
      const fields = [
        'id', 'name', 'location', 'email', 'phone', 'note', 
        'latitude', 'longitude', 'password_hash', 'website',
        'city', 'street', 'zip', 'region', 'licenses', 'drones',
        'travel', 'specialization', 'volunteer', 'registrationnumber', 'available', 'visible', 'visible_payment', 'visible_valid'
      ];
      
      fields.forEach(f => {
        const element = document.getElementById(f);
        if (element) {
          element.value = p[f] || '';
        }
      });
      document.getElementById('form-wrapper').style.display = 'block';
    }

    function submitForm(e) {
      e.preventDefault();
      const data = {};
      const fields = [
        'id', 'name', 'location', 'email', 'phone', 'note', 
        'latitude', 'longitude', 'password_hash', 'website',
        'city', 'street', 'zip', 'region', 'licenses', 'drones',
        'travel', 'specialization', 'volunteer', 'registrationnumber', 'available', 'visible', 'visible_payment', 'visible_valid' 
      ];
      
      fields.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          data[id] = element.value;
        }
      });

      fetch('/update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
        .then(res => res.text())
        .then(msg => {
          document.getElementById('status').textContent = msg;
          document.getElementById('form-wrapper').style.display = 'none';
          loadPilots();
        });
    }

    function deleteAll() {
      if (!confirm("Opravdu chcete smazat v≈°echny piloty?")) return;
      fetch('/delete-all', { method: 'POST' })
        .then(res => res.text())
        .then(msg => {
          document.getElementById('status').textContent = msg;
          loadPilots();
        });
    }

    function toggleAll(master) {
      const checkboxes = document.querySelectorAll('.row-checkbox');
      checkboxes.forEach(cb => cb.checked = master.checked);
    }

    function deleteSelected() {
      const selected = Array.from(document.querySelectorAll('.row-checkbox:checked'))
        .map(cb => cb.value);

      if (selected.length === 0) {
        alert("Nevybrali jste ≈æ√°dn√© piloty.");
        return;
      }

      if (!confirm(`Opravdu chcete smazat ${selected.length} vybran√Ωch pilot≈Ø?`)) return;

      fetch('/delete-selected', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ids: selected })
      })
        .then(res => res.text())
        .then(msg => {
          document.getElementById('status').textContent = msg;
          loadPilots();
        });
    }


    loadPilots();
  </script>
</body>
</html>

    
  </script>
</body>
</html>