<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<title>Dronov√° mapa pilot≈Ø v ƒåesku ‚Äì Najdi nebo se p≈ôidej | Spojujeme piloty a z√°kazn√≠ky</title>

    <meta name="description" content="Hled√°≈° pilota dronu nebo chce≈° b√Ωt vidƒõt na mapƒõ? Najdi pilota podle lokality, specializace, vybaven√≠ a p≈ôipoj se k ovƒõ≈ôen√© komunitƒõ." />

  <meta name="robots" content="index, follow" />
<link rel="canonical" href="https://www.najdipilota.cz/" />

  <!-- Open Graph pro Facebook a dal≈°√≠ s√≠tƒõ -->
  <meta property="og:title" content="Dronov√° mapa pilot≈Ø v ƒåesku" />
  <meta property="og:description" content="Spojujeme z√°kazn√≠ky s piloty dron≈Ø. Zobraz se na mapƒõ nebo si najdi pilota ve sv√©m okol√≠." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.najdipilota.cz/" />
  <meta property="og:image" content="icons/logo.png" />
  <meta name="google-site-verification" content="yxzi02d6ahPBVtx31lx_Mwg07khOFlY_fWUFdkyrsUE" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Vlastn√≠ styl -->
  <link rel="stylesheet" href="style.css" />

  <!-- Leaflet a MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<!-- Favicony -->
<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
<link rel="manifest" href="/icons/site.webmanifest">
<link rel="icon" href="/icons/favicon.ico" type="image/x-icon">

<!-- AOS Animations -->
<link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3KQTXQ496Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3KQTXQ496Y');
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons/css/flag-icons.min.css">


</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
  <div class="container">
    <a class="navbar-brand fw-bold d-flex align-items-center" href="/index.html">
      <img src="/icons/logo.png" alt="Logo NajdiPilota.cz" height="60" class="me-2" loading="lazy" aria-hidden="true" />
      <span class="fs-4">NajdiPilota.cz</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse justify-content-end align-items-center" id="mainNavbar">
      <!-- Navigace -->
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item" id="inzerent-nav-item" style="display:none;">
          <a class="nav-link text-warning fw-bold" href="#" data-bs-toggle="modal" data-bs-target="#inzerentModal">
            <i class="bi bi-megaphone-fill me-1"></i>Pro inzerenty
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/index.html">Mapa</a>
        </li>
        <li class="nav-item" id="messages-nav-item" style="display:none;">
          <a class="nav-link" href="/moje-zpravy.html"><i class="bi bi-envelope me-1"></i>Moje zpr√°vy</a>
        </li>
        
        
        
        <li class="nav-item"><a class="nav-link" href="/o-projektu.html">O projektu</a></li>
        <li class="nav-item"><a class="nav-link" href="/kontakt.html">Kontakt</a></li>
        <li class="nav-item" id="poptavky-nav-item" style="display:none;">
  <a class="nav-link" href="/poptavky.html"><i class="bi bi-briefcase me-1"></i>Popt√°vky</a>
</li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="langDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            üåê Jazyk
          </a>
          <ul class="dropdown-menu" aria-labelledby="langDropdown">
            <li><a class="dropdown-item" href="/index.html"><span class="fi fi-cz me-2"></span>ƒåesky</a></li>
            <li><a class="dropdown-item" href="/index_en.html"><span class="fi fi-gb me-2"></span>English</a></li>
            <!-- <li><a class="dropdown-item" href="/index_ua.html"><span class="fi fi-ua me-2"></span>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</a></li> -->
          </ul>
        </li>
      </ul>

      <!-- Tlaƒç√≠tka √∫ƒçtu -->
      <div class="account-buttons ms-lg-3">
        <span id="logged-info" class="fw-bold small"></span>

        <button id="edit-profile-btn" style="display:none;" class="pilot-login-btn">
          <i class="bi bi-pencil-square me-1"></i> <span>M≈Øj √∫ƒçet</span>
        </button>

        <button id="login-button" class="pilot-login-btn btn-sm user-action d-flex align-items-center justify-content-center px-3 py-2">
          <i class="bi bi-person-badge me-2"></i>
          <span id="login-toggle">P≈ôihl√°sit se jako pilot</span>
        </button>
      </div>
    </div>
  </div>
</nav>


  <!-- HERO -->
  <section class="landing-hero fade-in">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="hero-content text-center">
          <h1 class="hero-title">Najdi pilota dronu ve sv√©m okol√≠.
<br>Nebo se p≈ôidej a uka≈æ se na mapƒõ.</h1>
          <p class="hero-subtitle">Komunitn√≠ mapa ovƒõ≈ôen√Ωch pilot≈Ø v ƒåesku.
P≈ô√≠m√Ω kontakt bez prost≈ôedn√≠k≈Ø, p≈ôehledn√© profily s v√Ωbavou a specializac√≠.
Basic nebo Premium? Vyber si podle sebe.</p>
          <div class="text-center mt-4">
            <img src="/icons/logo.png" alt="Ikona dronu" class="img-fluid hero-logo" style="max-height: 220px;">
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- BENEFITY -->
<section class="section-spaced" data-aos="fade-up">
  <div class="container">
    
    <div class="row text-center mb-4" data-aos="fade-down">
      <div class="col">
        <h2 class="display-6 fw-bold">Proƒç vyu≈æ√≠vat NajdiPilota.cz?</h2>
        <p class="lead">Jednoduch√© a efektivn√≠ propojen√≠ pilot≈Ø dron≈Ø a z√°kazn√≠k≈Ø.</p>
      </div>
    </div>

    <div class="row g-4 justify-content-center">
      <!-- 1Ô∏è‚É£ Lok√°ln√≠ vyhled√°v√°n√≠ -->
      <div class="col-md-4 text-center" data-aos="fade-up" data-aos-delay="100">
        <div class="benefit-icon mb-3" style="font-size:2.5rem;">
          <i class="bi bi-geo-alt"></i>
        </div>
        <h3 class="benefit-title">Lok√°ln√≠ vyhled√°v√°n√≠</h3>
        <p>Najdi piloty ve sv√©m okol√≠ pomoc√≠ interaktivn√≠ mapy. Filtruj podle specializace a vybaven√≠.</p>
      </div>

      <!-- 2Ô∏è‚É£ ≈Ω√°dn√© provize -->
      <div class="col-md-4 text-center" data-aos="fade-up" data-aos-delay="200">
        <div class="benefit-icon mb-3" style="font-size:2.5rem;">
          <i class="bi bi-cash-coin"></i>
        </div>
        <h3 class="benefit-title">≈Ω√°dn√© provize</h3>
        <p>Komunikuj p≈ô√≠mo s piloty bez zbyteƒçn√Ωch proviz√≠. U≈°et≈ôi ƒças i pen√≠ze.</p>
      </div>

      <!-- 3Ô∏è‚É£ Ovƒõ≈ôen√≠ piloti -->
      <div class="col-md-4 text-center" data-aos="fade-up" data-aos-delay="300">
        <div class="benefit-icon mb-3" style="font-size:2.5rem;">
          <i class="bi bi-shield-check"></i>
        </div>
        <h3 class="benefit-title">Ovƒõ≈ôen√≠ piloti</h3>
        <p>V≈°echny profily pilot≈Ø jsou ovƒõ≈ôen√©. M≈Ø≈æe≈° si b√Ωt jist√Ω kvalitou slu≈æeb.</p>
      </div>
    </div>

  </div>
</section>



<!-- Tlaƒç√≠tka p≈ôihl√°≈°en√≠ -->
<div id="pilot-login-wrapper" class="d-flex flex-wrap align-items-center gap-2 justify-content-center" >

  


<!-- Modal pro inzerenty -->
<div class="modal fade" id="inzerentModal" tabindex="-1" aria-labelledby="inzerentModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-warning">
      <div class="modal-header bg-warning">
        <h5 class="modal-title" id="inzerentModalLabel">
          <i class="bi bi-building me-2"></i>Pro firmy a inzerenty
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zav≈ô√≠t"></button>
      </div>
      <div class="modal-body">
        <p>Hled√°te pilota pro nat√°ƒçen√≠, inspekci nebo mapov√°n√≠? Vyberte si z ovƒõ≈ôen√Ωch pilot≈Ø podle regionu a specializace.</p>
      </div>
      <div class="modal-footer">
        <a href="/inzerent.html" class="btn btn-outline-warning">
          <i class="bi bi-person-badge-fill me-1"></i> P≈ôihl√°sit se jako inzerent
        </a>
      </div>
    </div>
  </div>
</div>


  
</div>
    

    
    <div id="login-modal-backdrop"></div>

    <!-- P≈ôihla≈°ovac√≠ modal -->
    <div id="login-box" style="display: "display: none; position: relative;">
<button type="button" class="btn-close close-btn" aria-label="Zav≈ô√≠t"
        onclick="document.getElementById('login-box').style.display='none';"></button>
   <h3>P≈ôihl√°≈°en√≠ pilota</h3>


      <form id="login-form" onsubmit="pilotLogin(event)">
        <div class="mb-3">
          <label for="email" class="form-label">E-mail:</label>
          <input type="email" id="email" name="email" class="form-control" required />
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Heslo:</label>
          <input type="password" id="password" name="password" class="form-control" required />
        </div>
        <button type="submit" class="pilot-login-btn btn-sm user-action d-flex align-items-center justify-content-center px-3 py-2 w-100"><i class="bi bi-box-arrow-in-right me-2"></i>P≈ôihl√°sit se</button>
      </form>
      <p id="login-status" class="mt-3"></p>
      <a href="/register.html" class="link">Nejsem je≈°tƒõ registrov√°n ‚Äì chci se zaregistrovat</a>
      <a href="/forgot.html" class="link">Zapomenut√© heslo?</a>
    </div>
    
    <div id="map" class="mt-4" data-aos="fade-up" data-aos-delay="200">

</div>

  </div>

  <!-- Leaflet & Cluster -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Skript -->
  <script>
    const map = L.map('map').setView([49.8, 15.5], 7);
const fakeNames = [
  "Rychl√Ω Sysel",
  "L√©taj√≠c√≠ Brambor",
  "Dronislav Nebe≈°≈•√°k",
  "Turbo R√°kosn√≠k",
  "Bezpilotn√≠ Emil",
  "P√≠skaj√≠c√≠ P√°v",
  "Pilotka Haluz",
  "Franti≈°ek Vrtuln√≠k",
  "Lev√Ω Joystick",
  "Kapit√°n St√≠n",
  "Dr. Rotor",
  "Pan Toƒçiv√Ω",
  "Letu≈°ka Landov√°",
  "St≈ôemhlav√Ω Franta",
  "Nadzvukov√Ω Je≈æek",
  "L√©taj√≠c√≠ ƒåenda",
  "Rotorov√° R√≥za",
  "≈†um√≠c√≠ Fanda",
  "Bezpeƒçn√Ω B√©ƒèa",
  "Maj√°k z Oblak",
  "Dron√Ω Karel",
  "Letec ≈†matla",
  "Start√©r Stan√≠k",
  "P≈ôist√°vac√≠ Pepa",
  "Helikopt√©rn√≠k Honza",
  "Navig√°tor Nov√°k",
  "Senzorov√° So≈àa",
  "P√°n Mrak≈Ø",
  "Let√≠c√≠ Lojza",
  "Kamera Kamil",
  "Rotor R√≠≈°a",
  "V√Ω≈°komƒõr Va≈°ek",
  "Vzdu≈°n√Ω Vojta",
  "Tich√Ω ≈†um√°k",
  "Drnƒçiv√Ω Dan",
  "Mlha Milda",
  "Optika Otakar",
  "Ztracen√Ω Sign√°l",
  "Mistr Gimbal",
  "Ant√©na Aniƒçka",
  "Vrtulka Vƒõrka",
  "Letmo L√≠da",
  "Flyboy Felix",
  "Vzdu≈°n√° V√≠la",
  "Navigaƒçn√≠ Norbert",
  "Modr√° Letka",
  "K≈ô√≠dlat√Ω Karel",
  "Poln√≠ P≈ô√≠zrak",
  "Mapov√Ω Mirek",
  "Kliƒçkuj√≠c√≠ Kuba"
];


    
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      maxZoom: 18
    }).addTo(map);

    const markers = L.markerClusterGroup();
    const pilotCircles = [];
    fetch('/pilots')
      .then(res => res.json())
      .then(data => {
        data.forEach(p => {

        
  if (p.visible !== "ANO") return; // Skryj neviditeln√© piloty

  if (p.latitude != null && p.longitude != null) {

            let circleOptions = {
      radius: 2000, // V√Ωchoz√≠ r√°dius
      fillOpacity: 0.2, // V√Ωchoz√≠ opacity pro Free
      color: p.available === "ANO" ? 'green' : 'gray',
      fillColor: p.available === "ANO" ? '#4CAF50' : '#CCCCCC',
      weight: 1
    };

    // Zmƒõna pro r≈Øzn√© typy √∫ƒçt≈Ø
    if (p.type_account === "Free") {
      circleOptions.color = 'lightgreen';
      circleOptions.fillOpacity = 0.2;
    } else if (p.type_account === "Basic") {
      circleOptions.color = 'darkgreen';
      circleOptions.fillOpacity = 0.5;
    } else if (p.type_account === "Premium") {
  circleOptions.color = 'purple';         // Barva obrysu
  circleOptions.fillColor = 'purple';     // Barva v√Ωplnƒõ
  circleOptions.fillOpacity = 0.8;        // Opacity v√Ωplnƒõ
  circleOptions.radius = 10000;           // Dvojn√°sobnƒõ vƒõt≈°√≠ r√°dius ne≈æ Free a Basic
  circleOptions.weight = 3;               // Tlou≈°≈•ka linie (nastavena na 3)
}

            const circle = L.circle([p.latitude, p.longitude], circleOptions)


            .bindPopup(() => {
  const loggedIn = localStorage.getItem("loggedEmail") || localStorage.getItem("inzerentEmail");
  const isAvailable = p.available === "ANO";
  const fakeName = fakeNames[Math.floor(Math.random() * fakeNames.length)];
  const hasBuildBadge = p.id && Number(p.id) <= 80;
const buildBadge = hasBuildBadge 
  ? `<img src="/icons/build50_v1.png" alt="Build 50" width="64" height="64" class="ms-2 align-middle" title="Build 50">`
  : "";
  // Voliteln√©: jm√©no s odznakem (pro re-use)
const pilotNameWithBadge = `${p.name || ''}${buildBadge}`;
const fakeNameWithBadge  = `${fakeName}${buildBadge}`;
  // Nov√©: ƒçti souhlas z backendu (preferuj p.hasPublicConsent), o≈°et≈ôi i "t"/"f"
const hasPublicConsent = (() => {
  const v = (p.hasPublicConsent ?? p.granted ?? false);
  if (typeof v === 'boolean') return v;
  const s = String(v).trim().toLowerCase();
  return s === 'true' || s === 't' || s === '1' || s === 'ano' || s === 'yes';
})();

if (!hasPublicConsent) {
  return `
    <div class="pilot-card">
      <h3><i class="bi bi-person-circle me-1"></i>${fakeNameWithBadge}</h3>

      <div class="d-flex flex-wrap gap-2 mb-2">
        ${p.volunteer === 'ANO' ? `<span class="badge-volunteer">Dobrovoln√≠k</span>` : ''}
        <span class="badge-gdpr">Bez GDPR souhlasu ‚Äì kontakt p≈ôes administr√°tora</span>
      </div>

      ${p.specialization ? `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specializace:</strong> ${p.specialization}</p>` : ''}
    </div>
  `;
}



 

  let html = `<div class="pilot-card">`;
 
  if (isAvailable && loggedIn) {
  if (p.type_account === "Free") {
      // Free √∫ƒçet - omezen√© informace
     html += `
  <div class="d-flex justify-content-between align-items-center mb-1">
    <h3 class="mb-0"><i class="bi bi-person-circle me-1"></i>${p.name}</h3>
    ${p.registrationnumber && p.registrationnumber.startsWith("CZE") && p.registrationnumber.length === 16 
      ? `<img src="/icons/approved_4.png" alt="Ovƒõ≈ôen√Ω provozovatel" width="60" class="me-2">` 
      : ''}
    ${p.id && Number(p.id) <= 80
      ? `<img src="/icons/build50_v1.png" alt="Build 50" width="64" height="64" class="ms-2 align-middle" title="Build 50">`
      : ''}
  </div>
`;
  
      if (p.volunteer === 'ANO') {
        html += `<div class="mb-2"><span class="badge-volunteer">Dobrovoln√≠k</span></div>`;
      }

      if (p.drones) html += `<p><i class="bi bi-drone me-1"></i><strong>Drony:</strong> ${p.drones}</p>`;
      if (p.specialization) html += `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specializace:</strong> ${p.specialization}</p>`;

      html += `</div>`;
    } else if (p.type_account === "Basic") {
  // Basic √∫ƒçet - v√≠ce informac√≠
 html += `
  <div class="d-flex justify-content-between align-items-center mb-1">
    <h3 class="mb-0"><i class="bi bi-person-circle me-1"></i>${p.name}</h3>
    ${p.registrationnumber && p.registrationnumber.startsWith("CZE") && p.registrationnumber.length === 16 
      ? `<img src="/icons/approved_4.png" alt="Ovƒõ≈ôen√Ω provozovatel" width="60" class="me-2">` 
      : ''}
    ${p.id && Number(p.id) <= 80
      ? `<img src="/icons/build50_v1.png" alt="Build 50" width="64" height="64" class="ms-2 align-middle" title="Build 50">`
      : ''}
  </div>
`;
  
  
  
 if (p.volunteer === 'ANO') {
        html += `<div class="mb-2"><span class="badge-volunteer">Dobrovoln√≠k</span></div>`;
      }
  if (p.drones) html += `<p><i class="bi bi-drone me-1"></i><strong>Drony:</strong> ${p.drones}</p>`;
  if (p.note) html += `<p><i class="bi bi-chat-left-text me-1"></i><strong>O mnƒõ:</strong> ${p.note}</p>`;
  if (p.travel) html += `<p><i class="bi bi-signpost me-1"></i><strong>Doj√≠≈ædƒõn√≠:</strong> ${p.travel}</p>`;
  if (p.licenses) html += `<p><i class="bi bi-award me-1"></i><strong>Licence:</strong> ${p.licenses}</p>`;
  if (p.specialization) html += `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specializace:</strong> ${p.specialization}</p>`;

  // Tlaƒç√≠tko pro naps√°n√≠ pilotovi
  html += `
    <div class="mt-3">
      <button class="pilot-login-btn btn-sm user-action d-flex align-items-center justify-content-center px-3 py-2 w-100" onclick="contactPilot('${p.email}')">
        ‚úâÔ∏è Napsat pilotovi
      </button>
    </div>
  `;
}
 else if (p.type_account === "Premium") {
      // Premium √∫ƒçet - v≈°echny informace
      html += `
  <div class="d-flex justify-content-between align-items-center mb-1">
    <h3 class="mb-0"><i class="bi bi-person-circle me-1"></i>${p.name}</h3>
    ${p.registrationnumber && p.registrationnumber.startsWith("CZE") && p.registrationnumber.length === 16 
      ? `<img src="/icons/approved_4.png" alt="Ovƒõ≈ôen√Ω provozovatel" width="60" class="me-2">` 
      : ''}
    ${p.id && Number(p.id) <= 80
      ? `<img src="/icons/build50_v1.png" alt="Build 50" width="64" height="64" class="ms-2 align-middle" title="Build 50">`
      : ''}
  </div>
`;
  
  
      if (p.volunteer === 'ANO') {
        html += `<div class="mb-2"><span class="badge-volunteer">Dobrovoln√≠k</span></div>`;
      }

      // Kontakty pro Premium √∫ƒçty
      if (p.email) html += `<p><i class="bi bi-envelope-at me-1"></i><a href="mailto:${p.email}">${p.email}</a></p>`;
      if (p.phone) html += `<p><i class="bi bi-telephone-fill me-1"></i><a href="tel:${p.phone}">${p.phone}</a></p>`;

      html += `<p><i class="bi bi-drone me-1"></i><strong>Drony:</strong> ${p.drones}</p>`;
      if (p.specialization) html += `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specializace:</strong> ${p.specialization}</p>`;
      if (p.travel) html += `<p><i class="bi bi-signpost me-1"></i><strong>Doj√≠≈ædƒõn√≠:</strong> ${p.travel}</p>`;
      if (p.licenses) html += `<p><i class="bi bi-award me-1"></i><strong>Licence:</strong> ${p.licenses}</p>`;
    }
  } else if (!isAvailable) {
    // Pilot nen√≠ k dispozici
    html += `
      <h3><i class="bi bi-person-circle me-1"></i>${fakeNameWithBadge}</h3>

      <br>
      ${p.volunteer === 'ANO' ? `<div class="mb-2"><span class="badge-volunteer">Dobrovoln√≠k</span></div>` : ''}
      <p class="text-danger"><i class="bi bi-exclamation-triangle-fill me-1"></i>Tento pilot moment√°lnƒõ nen√≠ k dispozici</p>
      ${p.specialization ? `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specializace:</strong> ${p.specialization}</p>` : ''}
    `;
  } else {
  // Nep≈ôihl√°≈°en√Ω u≈æivatel
  html += `
    <h3><i class="bi bi-person-circle me-1"></i>${fakeNameWithBadge}</h3>
    <br>
    ${p.volunteer === 'ANO' ? `<div class="mb-2"><span class="badge-volunteer">Dobrovoln√≠k</span></div>` : ''}
  `;

  // Pouze pro Premium √∫ƒçty zobraz√≠me skryt√Ω kontakt
  if (p.type_account === "Premium") {
    if (p.email) {
      html += `<p><i class="bi bi-envelope-at me-1"></i><span class="text-muted">[e-mail po p≈ôihl√°≈°en√≠]</span></p>`;
    }
    if (p.phone) {
      html += `<p><i class="bi bi-telephone-fill me-1"></i><span class="text-muted">[telefon po p≈ôihl√°≈°en√≠]</span></p>`;
    }
  }

  // Ostatn√≠ √∫daje zobrazujeme bƒõ≈ænƒõ
  if (p.specialization) {
    html += `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specializace:</strong> ${p.specialization}</p>`;
  }
  if (p.travel) {
    html += `<p><i class="bi bi-signpost me-1"></i><strong>Doj√≠≈ædƒõn√≠:</strong> ${p.travel}</p>`;
  }

  html += `
    <p class="text-muted"><em>P≈ôihlaste se jako inzerent a z√≠skejte p≈ô√≠stup ke kontakt≈Øm pilot≈Ø.</em></p>
  </div>
  `;
}

  html += `</div>`;
  return html;
})

            markers.addLayer(circle);
            pilotCircles.push(circle);
          }
        });
        map.addLayer(markers);
        if (markers.getBounds().isValid()) {
          map.fitBounds(markers.getBounds(), { padding: [30, 30] });
        }
      });

    map.on('zoomend', () => {
  const zoom = map.getZoom();
  pilotCircles.forEach(circle => {
    const maxZoom = 14;
    const minZoom = 7;
    const minRadius = 100;
    const maxRadius = 2000;

    // Nastaven√≠ r√°diusu pro r≈Øzn√© typy √∫ƒçt≈Ø
    let accountMinRadius = minRadius;
    let accountMaxRadius = maxRadius;

    if (circle.options.fillColor === 'darkgreen') { // Basic √∫ƒçet (tmavƒõ zelen√Ω)
      accountMinRadius = 100;   // Min r√°dius pro Basic
      accountMaxRadius = 4000;  // Max r√°dius pro Basic
    } else if (circle.options.fillColor === 'purple') { // Premium √∫ƒçet (fialov√Ω)
      accountMinRadius = 100;  // Min r√°dius pro Premium
      accountMaxRadius = 10000; // Max r√°dius pro Premium
    }

    const ratio = (zoom - minZoom) / (maxZoom - minZoom);
    const radius = Math.max(accountMinRadius, accountMaxRadius - (accountMaxRadius - accountMinRadius) * ratio);
    circle.setRadius(radius);

    const opacity = 0.2 + 0.2 * (1 - ratio);
    circle.setStyle({ fillOpacity: opacity });
  });
});

    document.addEventListener("DOMContentLoaded", () => {
      const loginBox = document.getElementById("login-box");
      const toggle = document.getElementById("login-toggle");
      const status = document.getElementById("user-status");
      const loggedEmail = localStorage.getItem("loggedEmail");
      const editBtn = document.getElementById("edit-profile-btn");
      const messagesNavItem = document.getElementById("messages-nav-item");

const inzerentNavItem = document.getElementById("inzerent-nav-item");
  if (!loggedEmail && inzerentNavItem) {
  inzerentNavItem.style.display = "block";
}

if (loggedEmail) {
  loginBox.style.display = "none";
  editBtn.style.display = "inline-block";
  toggle.textContent = "Odhl√°sit";
  
  
  // Zobrazen√≠ "Moje zpr√°vy" pro p≈ôihl√°≈°en√© u≈æivatele
  const messagesNavItem = document.getElementById("messages-nav-item");
  if (messagesNavItem) {
    messagesNavItem.style.display = "block";
  }

  // Zobrazen√≠ "Popt√°vky" jen pro √∫ƒçty Basic/Premium
  const poptavkyNavItem = document.getElementById("poptavky-nav-item");
  if (poptavkyNavItem && loggedEmail) {
    fetch('/get-my-pilot', { credentials: 'include' })
      .then(r => r.ok ? r.json() : null)
      .then(me => {
        const t = (me?.type_account || '').toLowerCase();
        if (t === 'basic' || t === 'premium') {
          poptavkyNavItem.style.display = "block";
        } else {
          poptavkyNavItem.style.display = "none";
        }
      })
      .catch(() => { poptavkyNavItem.style.display = "none"; });
  }

  toggle.addEventListener("click", () => {
    localStorage.removeItem("loggedEmail");
    window.location.reload();
  });
} else {
  toggle.addEventListener("click", () => {
    loginBox.style.display = loginBox.style.display === "none" ? "block" : "none";
  });
}

if (loggedEmail && editBtn) {
  editBtn.style.display = "inline-block";
  editBtn.addEventListener("click", () => {
    window.location.href = "/account.html?email=" + encodeURIComponent(loggedEmail);
  });
}


      window.pilotLogin = function(event) {
        event.preventDefault();
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const statusBox = document.getElementById("login-status");

        fetch("/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        })
        .then(res => {
          if (!res.ok) throw new Error("Neplatn√Ω e-mail nebo heslo.");
          return res.text();
        })
        .then(async msg => {
  // Dotaz na server, kter√Ω vr√°t√≠ id pilota
  const res = await fetch(`/get-user-id?email=${encodeURIComponent(email)}&type=pilot`);
  const data = await res.json();

  if (data.success) {
    localStorage.setItem("pilotId", data.id);      // ulo≈æ√≠ ID pilota
    localStorage.setItem("pilotEmail", data.email);
  }

  localStorage.setItem("loggedEmail", email);
  statusBox.style.color = "green";
  statusBox.textContent = msg;
  window.location.href = "/account.html?email=" + encodeURIComponent(email);
})
        .catch(err => {
          statusBox.style.color = "red";
          statusBox.textContent = err.message;
        });
      };
    });

function contactPilot(pilotEmail) {
  const currentUserEmail = localStorage.getItem('loggedEmail') || localStorage.getItem('inzerentEmail');
  const currentUserType  = localStorage.getItem('loggedEmail') ? 'pilot' : 'inzerent';
  
  if (!currentUserEmail) {
    alert("Pro komunikaci s piloty se mus√≠te p≈ôihl√°sit.");
    return;
  }

  Promise.all([
    fetch(`/get-user-id?email=${encodeURIComponent(currentUserEmail)}&type=${currentUserType}`).then(res => res.json()),
    fetch(`/get-user-id?email=${encodeURIComponent(pilotEmail)}&type=pilot`).then(res => res.json())
  ])
  .then(([currentUser, partner]) => {
    return fetch('/create-conversation', {   // ‚Üê spr√°vn√Ω endpoint
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        pilotEmail: pilotEmail,
        advertiserEmail: currentUserType === 'inzerent' ? currentUserEmail : null
      })
    }).then(res => res.json());
  })
  .then(({ success, conversationId }) => {   // ‚Üê server vrac√≠ conversationId
    if (!success) throw new Error("Nepoda≈ôilo se vytvo≈ôit konverzaci.");
    window.location.href = `/chat.html?conversationId=${conversationId}`;
  })
  .catch(err => {
    console.error("Chyba p≈ôi vytv√°≈ôen√≠ konverzace:", err);
    alert("Pro nav√°z√°n√≠ konverzace se p≈ôihla≈°te jako inzerent.");
  });
}document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("sendContactMessage").addEventListener("click", () => {
    const pilotEmail = document.getElementById("contactPilotEmail").value;
    const message = document.getElementById("contactMessage").value.trim();

    if (!message) {
      alert("Pros√≠m napi≈°te zpr√°vu.");
      return;
    }

    fetch('/contact-pilot', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ to: pilotEmail, message })
    })
    .then(res => {
      if (!res.ok) throw new Error("Nepoda≈ôilo se odeslat zpr√°vu.");
      return res.text();
    })
    .then(response => {
      alert(response);
      bootstrap.Modal.getInstance(document.getElementById('contactPilotModal')).hide();
    })
    .catch(err => alert("‚ùå Chyba: " + err.message));
  });
});
  </script>
<script>

  const advertiserEmail = localStorage.getItem("inzerentEmail");

  if (advertiserEmail) {
    const banner = document.createElement("div");
    banner.className = "alert alert-warning text-center m-3 d-flex justify-content-center align-items-center";
    banner.innerHTML = `
      <div>
        <strong>P≈ôihl√°≈°en inzerent:</strong> ${advertiserEmail}
      </div>
    `;

    const logoutBtn = document.createElement("button");
    logoutBtn.className = "btn btn-sm btn-outline-dark ms-3";
    logoutBtn.textContent = "Odhl√°sit se";
    logoutBtn.onclick = () => {
      localStorage.removeItem("inzerentEmail");
      window.location.reload();
    };

    banner.appendChild(logoutBtn);
    document.body.prepend(banner);
  }


fetch(`/get-conversations?pilotEmail=${encodeURIComponent(pilotEmail)}&inzerentEmail=${encodeURIComponent(advertiserEmail)}`)

        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("conversations-list");
          container.innerHTML = "";

          if (data.success && data.conversations.length > 0) {
            data.conversations.forEach(conv => {
              const conversationCard = document.createElement("a");
              conversationCard.href = `/chat.html?conversationId=${conv.id}&pilotEmail=${encodeURIComponent(pilotEmail)}&inzerentEmail=${encodeURIComponent(conv.advertiser_email)}`;
              conversationCard.className = `conversation-card d-block p-3 border-bottom ${conv.unread ? 'unread' : ''}`;
              
              conversationCard.innerHTML = `
                <div class="d-flex justify-content-between">
                  <div>
                    <h5 class="mb-1">${conv.advertiser_name || conv.advertiser_email}</h5>
                    <p class="mb-1 last-message">${conv.last_message || '≈Ω√°dn√© zpr√°vy'}</p>
                  </div>
                  <div class="text-end">
                    <span class="time-ago">${formatTimeAgo(conv.last_message_time)}</span>
                    ${conv.unread ? '<span class="badge bg-primary ms-2">Nov√©</span>' : ''}
                  </div>
                </div>
              `;
              container.appendChild(conversationCard);
            });
          } else {
            container.innerHTML = `
              <div class="text-center py-5">
                <i class="bi bi-envelope-open display-5 text-muted"></i>
                <p class="mt-3">Zat√≠m nem√°te ≈æ√°dn√© zpr√°vy</p>
                <a href="/index.html" class="btn btn-primary mt-2">Naj√≠t zak√°zky</a>
              </div>
            `;
          }
        })
        .catch(err => {
          console.error("Chyba p≈ôi naƒç√≠t√°n√≠ konverzac√≠:", err);
          document.getElementById("conversations-list").innerHTML = `
            <div class="text-center py-5 text-danger">
              <i class="bi bi-exclamation-triangle display-5"></i>
              <p class="mt-3">Nepoda≈ôilo se naƒç√≠st konverzace</p>
              <button onclick="window.location.reload()" class="btn btn-outline-primary mt-2">
                <i class="bi bi-arrow-repeat"></i> Zkusit znovu
              </button>
            </div>
          `;
        });

      // Helper function to format time ago
      function formatTimeAgo(timestamp) {
        if (!timestamp) return "";
        const now = new Date();
        const msgDate = new Date(timestamp);
        const diff = Math.floor((now - msgDate) / 1000); // difference in seconds
        
        if (diff < 60) return "pr√°vƒõ teƒè";
        if (diff < 3600) return `${Math.floor(diff/60)} min`;
        if (diff < 86400) return `${Math.floor(diff/3600)} h`;
        return `${Math.floor(diff/86400)} d`;
      }
    });
</script>
<!-- CTA SEKCE: PILOT / INZERENT -->
<section class="cta-section py-5" data-aos="fade-up">
  <div class="container">
    <div class="row g-4">
      
      <!-- PILOT -->
      <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
        <div class="cta-card pilot h-100">
          <div class="cta-header text-center">
            <div class="cta-icon">
              <i class="bi bi-person-badge"></i>
            </div>
            <h3 class="cta-title">Jsem pilot</h3>
            <p class="cta-subtitle">Vytvo≈ô si profil a zaƒçni p≈ôij√≠mat popt√°vky</p>
          </div>
          <div class="cta-body">
            <ul class="cta-features">
              <li>Zobrazen√≠ na mapƒõ pilot≈Ø</li>
              <li>Specifikace vybaven√≠ a specializace</li>
              <li>P≈ôij√≠mej popt√°vky od inzerent≈Ø</li>
              <li>Sta≈à se ovƒõ≈ôen√Ωm provozovatelem dronu</li>
              <li>R≈Øzn√© typy √∫ƒçt≈Ø (Free, Basic, Premium)</li>
            </ul>
          </div>
          <div class="cta-footer text-center">
            <a href="/register.html" class="btn btn-landing btn-pilot">
              <i class="bi bi-person-plus me-1"></i> Vytvo≈ôit profil pilota
            </a>
          </div>
        </div>
      </div>

      <!-- INZERENT -->
      <div class="col-lg-6" data-aos="fade-up" data-aos-delay="300">
        <div class="cta-card inzerent h-100">
          <div class="cta-header text-center">
            <div class="cta-icon">
              <i class="bi bi-megaphone"></i>
            </div>
            <h3 class="cta-title">Jsem inzerent</h3>
            <p class="cta-subtitle">Najdi ide√°ln√≠ho pilota pro sv≈Øj projekt</p>
          </div>
          <div class="cta-body">
            <ul class="cta-features">
              <li>Prohl√≠≈æej mapu ovƒõ≈ôen√Ωch pilot≈Ø</li>
              <li>Filtruj podle specializace a lokality</li>
              <li>Kontaktuj piloty nap≈ô√≠mo</li>
              <li>U≈°et≈ôi ƒças a pen√≠ze</li>
              <li>Jednoduch√° registrace</li>
            </ul>
          </div>
          <div class="cta-footer text-center">
            <a href="/inzerent-register.html" class="btn btn-landing btn-inzerent">
              <i class="bi bi-building me-1"></i> Registrovat jako inzerent
            </a>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const inzerentEmail = localStorage.getItem("inzerentEmail");
    const loginWrapper = document.getElementById("pilot-login-wrapper");

    if (inzerentEmail && loginWrapper) {
      loginWrapper.style.display = "none";
    }
  });
</script>



<div class="modal fade" id="contactPilotModal" tabindex="-1" aria-labelledby="contactPilotModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="contactPilotModalLabel">Napsat pilotovi</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zav≈ô√≠t"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="contactMessage" class="form-label">Va≈°e zpr√°va</label>
          <textarea id="contactMessage" class="form-control" rows="5" placeholder="Napi≈°te zde svou zpr√°vu..."></textarea>
        </div>
        <input type="hidden" id="contactPilotEmail">
      </div>

<!-- Modal pro souhlas se zve≈ôejnƒõn√≠m kontakt≈Ø -->
<div class="modal fade" id="publicContactConsentModal" tabindex="-1" aria-labelledby="publicContactConsentLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content border-warning">
      <div class="modal-header bg-warning">
        <h5 class="modal-title" id="publicContactConsentLabel">Souhlas se zve≈ôejnƒõn√≠m kontakt≈Ø</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zav≈ô√≠t"></button>
      </div>
      <div class="modal-body">
        Souhlas√≠m, aby m≈Øj e‚Äëmail a telefon byly ve≈ôejnƒõ zobrazeny na m√©m profilu.
        <div class="form-check mt-3">
          <input class="form-check-input" type="checkbox" id="premiumConsentCheck">
          <label class="form-check-label" for="premiumConsentCheck">
            Souhlas√≠m se zve≈ôejnƒõn√≠m kontaktn√≠ch √∫daj≈Ø
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Zru≈°it</button>
        <button type="button" class="btn btn-warning" id="confirmPremiumConsent">Potvrdit</button>
      </div>
    </div>
  </div>
</div>


<script>
document.getElementById('confirmPremiumConsent').addEventListener('click', function() {
  if (!document.getElementById('premiumConsentCheck').checked) {
    alert("Mus√≠te potvrdit souhlas se zve≈ôejnƒõn√≠m kontakt≈Ø.");
    return;
  }

  fetch('/save-consent', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      consent_type: 'public_contact',
      consent_text: 'Souhlas se zve≈ôejnƒõn√≠m e-mailu a telefonu na ve≈ôejn√©m profilu.',
      timestamp: new Date().toISOString()
    })
  })
  .then(res => {
    if (!res.ok) throw new Error("Nepoda≈ôilo se ulo≈æit souhlas.");
    alert("Souhlas byl ulo≈æen. Va≈°e kontakty budou nyn√≠ viditeln√©.");
    location.reload();
  })
  .catch(err => alert(err.message));
});
</script>

      <div class="modal-footer">
        <button type="button" class="pilot-login-btn btn-sm user-action d-flex align-items-center justify-content-center px-3 py-2 w-100" data-bs-dismiss="modal">Zav≈ô√≠t</button>
        <button type="button" class="pilot-login-btn btn-sm user-action d-flex align-items-center justify-content-center px-3 py-2 w-100" id="sendContactMessage">Odeslat</button>
      </div>
    </div>
  </div>
</div>

<!-- INSTAGRAM FEED -->
<section id="instagram-feed" class="py-5 bg-light border-top" data-aos="fade-up">
  <div class="container text-center">
    <h2 class="fw-bold mb-3">Z komunity #NajdiPilota üöÅ</h2>
    <p class="text-muted mb-4">Posledn√≠ z√°bƒõry z na≈°eho Instagramu</p>

    <div id="insta-gallery" class="d-flex flex-wrap justify-content-center gap-3"></div>

    <div class="mt-4">
      <a href="https://www.instagram.com/najdipilota/" target="_blank" class="btn btn-outline-dark">
        <i class="bi bi-instagram me-1"></i> Sleduj n√°s na Instagramu
      </a>
    </div>
  </div>
</section>

<script>
fetch('/api/instagram-feed.php')
  .then(res => res.json())
  .then(data => {
    const gallery = document.getElementById('insta-gallery');
    if (!data.data) return;
    data.data.slice(0, 3).forEach(post => {
      const imgUrl = post.media_type === 'VIDEO' ? post.thumbnail_url : post.media_url;
      const a = document.createElement('a');
      a.href = post.permalink;
      a.target = '_blank';
      a.innerHTML = `<img src="${imgUrl}" class="rounded shadow-sm" style="width:200px;height:200px;object-fit:cover;">`;
      gallery.appendChild(a);
    });
  })
  .catch(err => console.error('Chyba p≈ôi naƒç√≠t√°n√≠ Instagram feedu:', err));
</script>



<footer class="footer mt-5 pt-4 pb-4 bg-light border-top">
  <div class="container">
    <div class="row gy-3 justify-content-between">
      
      <!-- Logo a popis -->
      <div class="col-md-4">
        <a href="/" class="d-flex align-items-center mb-2 text-decoration-none text-dark">
          <img src="/icons/logo.png" alt="Logo NajdiPilota" height="40" class="me-2" />
          <span class="fw-bold fs-5">NajdiPilota.cz</span>
        </a>
        <p class="small text-muted">Spojujeme z√°kazn√≠ky s ovƒõ≈ôen√Ωmi piloty dron≈Ø po cel√© ƒåR. Rychl√© spojen√≠ bez prost≈ôedn√≠k≈Ø.</p>
      </div>

      <!-- Navigace -->
      <div display="no" class="col-md-2">
        <h6 class="fw-bold">Navigace</h6>
        <ul class="list-unstyled">
          <li><a href="/index.html" class="text-decoration-none text-muted">Mapa pilot≈Ø</a></li>
          <li><a href="/o-projektu.html" class="text-decoration-none text-muted">O projektu</a></li>
          <li><a href="/kontakt.html" class="text-decoration-none text-muted">Kontakt</a></li>
        <li><a href="/v-procesu.html" class="text-decoration-none text-muted">Blog</a></li>
        </ul>
      </div>

      <!-- Pr√°vn√≠ -->
      <div class="col-md-3">
        <h6 class="fw-bold">Informace</h6>
        <ul class="list-unstyled">
          <li><a href="/gdpr.html" class="text-decoration-none text-muted">Zpracov√°n√≠ osobn√≠ch √∫daj≈Ø</a></li>
          <li><a href="/obchodni-podminky.html" class="text-decoration-none text-muted">Obchodn√≠ podm√≠nky</a></li>
          <li><a href="mailto:dronadmin@seznam.cz?subject=Chyba na webu" class="text-decoration-none text-muted">Nahl√°sit chybu</a></li>
        </ul>
      </div>

      <!-- Kontakt -->
      <div class="col-md-3">
        <h6 class="fw-bold">Provozovatel</h6>
        <p class="small text-muted mb-1">Ing. Bohuslav Vladyka<br>IƒåO: 08578591<br>Praha, ƒåesk√° republika</p>
        <p class="small text-muted mb-0">üìß <a href="mailto:dronadmin@seznam.cz" class="text-muted">dronadmin@seznam.cz</a></p>
      </div>

    </div>

    <hr class="my-4">

    <div class="d-flex justify-content-between align-items-center small text-muted">
      <span>&copy; <span id="year"></span> NajdiPilota.cz</span>
      <div>
      
        <a href="https://www.instagram.com/najdipilota/" class="text-muted me-3"><i class="bi bi-instagram"></i></a>
        
      </div>
    </div>
  </div>
</footer>

<script>
  // Vlo≈æ√≠ aktu√°ln√≠ rok do copyrightu
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("year").textContent = new Date().getFullYear();
  });
</script>

<script>
  // Pokud nen√≠ str√°nka urƒçena pro inzerenta, odhl√°s√≠me ho
  document.addEventListener("DOMContentLoaded", () => {
    if (localStorage.getItem("inzerentEmail")) {
      localStorage.removeItem("inzerentEmail");
    }
  });
</script>

<script>
  // Automatick√© p≈ôid√°n√≠ t≈ô√≠dy 'active' na aktu√°ln√≠ str√°nku v menu
  document.addEventListener("DOMContentLoaded", () => {
    const currentPage = window.location.pathname;
    const navLinks = document.querySelectorAll('.navbar-nav .nav-item .nav-link');
    
    navLinks.forEach(link => {
      if (link.getAttribute('href') === currentPage) {
        link.parentElement.classList.add('active');
      }
    });
  });
</script>

<script>
  // badge do horn√≠ navigace (index.html)
  function renderUnreadBadgeIntoNav(count) {
    const li = document.getElementById('messages-nav-item');
    if (!li) return;
    const a = li.querySelector('a.nav-link');
    if (!a) return;

    let badge = a.querySelector('#unread-badge');
    if (!badge) {
      badge = document.createElement('span');
      badge.id = 'unread-badge';
      badge.className = 'badge rounded-pill bg-danger ms-2';
      a.appendChild(badge);
    }
    if (count > 0) {
      badge.textContent = String(count);
      badge.style.display = '';
    } else {
      badge.style.display = 'none';
    }
  }

  async function refreshUnreadNavBadge() {
    const email = localStorage.getItem('loggedEmail');
    if (!email) return;
    try {
      const r = await fetch('/unread-count?pilotEmail=' + encodeURIComponent(email));
      const data = await r.json();
      renderUnreadBadgeIntoNav(data.count || 0);
    } catch {}
  }

  document.addEventListener('DOMContentLoaded', () => {
    const loggedEmail = localStorage.getItem('loggedEmail');
    if (loggedEmail) {
      // jen pro p≈ôihl√°≈°en√© piloty
      refreshUnreadNavBadge();
      setInterval(refreshUnreadNavBadge, 60000); // refresh ka≈ædou minutu
    }
  });
</script>

<script>
  // Aktivace animac√≠ p≈ôi scrollov√°n√≠
  document.addEventListener('DOMContentLoaded', () => {
    const elements = document.querySelectorAll('.fade-in');
    const logo = document.querySelector('.hero-logo');

    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.2 });

    elements.forEach(el => observer.observe(el));
    if (logo) observer.observe(logo);
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
  AOS.init({
    duration: 1000,  // d√©lka animace v ms
    offset: 80,      // vzd√°lenost od spodn√≠ hrany viewportu
    once: true       // animovat jen jednou
  });
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const isLoggedInPilot = !!localStorage.getItem("loggedEmail");
  const isLoggedInAdvertiser = !!localStorage.getItem("inzerentEmail");

  if (isLoggedInPilot || isLoggedInAdvertiser) {
    // Skryj sekce trvale a √∫plnƒõ
    const sections = document.querySelectorAll(".landing-hero, .section-spaced, .cta-section");
    sections.forEach(el => {
      el.style.display = "none";
      el.classList.add("hidden-section"); // z√°loha pro jistotu
    });

    // √öprava mapy
    const mapElement = document.getElementById("map");
    if (mapElement) {
      mapElement.style.marginTop = "0";
      mapElement.style.height = "calc(100vh - 80px)";
      mapElement.style.opacity = "1";
    }

    // ü™Ñ P≈ôepoƒçet velikosti mapy po zmƒõnƒõ layoutu
    setTimeout(() => {
      if (window.map && typeof window.map.invalidateSize === "function") {
        window.map.invalidateSize();
      }
    }, 400);

    // Voliteln√©: skryj i footer (pokud chce≈° opravdu fullscreen)
    // document.querySelector("footer")?.style.display = "none";
  }
});

</script>

<script>
  function updateNavbarForPilot() {
    // Skryj ‚ÄûO projektu‚Äú a ‚ÄûKontakt‚Äú
    document.querySelectorAll('a[href="/o-projektu.html"], a[href="/kontakt.html"]').forEach(el => {
      el.closest('li').style.display = 'none';
    });

    // Zobraz ‚ÄûPopt√°vky‚Äú
    const poptavky = document.getElementById('poptavky-nav-item');
    if (poptavky) poptavky.style.display = 'block';
  }

  // Po p≈ôihl√°≈°en√≠ pilota (nap≈ô. po localStorage)
  document.addEventListener('DOMContentLoaded', () => {
    const loggedEmail = localStorage.getItem('loggedEmail');
    if (loggedEmail) {
      updateNavbarForPilot();
    }
  });
</script>

</body>
</html>
