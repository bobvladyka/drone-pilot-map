<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<title>Drone Pilot Map in Czechia ‚Äì Find or Join | Connecting Pilots and Clients</title>

    <meta name="description" content="Looking for a drone pilot or want to be visible on the map? Find pilots by location, specialization, and equipment ‚Äî or join a verified community." />

  <meta name="robots" content="index, follow" />
<link rel="canonical" href="https://www.najdipilota.cz/" />

  <!-- Open Graph for Facebook and others -->
  <meta property="og:title" content="Drone Pilot Map in Czechia" />
  <meta property="og:description" content="We connect customers with drone pilots. Show up on the map or find a pilot near you." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.najdipilota.cz/" />
  <meta property="og:image" content="icons/logo.png" />
  <meta name="google-site-verification" content="yxzi02d6ahPBVtx31lx_Mwg07khOFlY_fWUFdkyrsUE" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Custom style -->
  <link rel="stylesheet" href="style.css" />

  <!-- Leaflet & MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<!-- Favicons -->
<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
<link rel="manifest" href="/icons/site.webmanifest">
<link rel="icon" href="/icons/favicon.ico" type="image/x-icon">


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3KQTXQ496Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3KQTXQ496Y');
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons/css/flag-icons.min.css">


</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
  <div class="container">
    <a class="navbar-brand fw-bold d-flex align-items-center" href="/index.html">
  <img src="/icons/logo.png" alt="NajdiPilota.cz logo" height="60" class="me-2" loading="lazy" aria-hidden="true" />
  <span class="fs-4">NajdiPilota.cz</span>
</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse" id="mainNavbar">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
	<li class="nav-item" id="inzerent-nav-item" style="display:none;">
  <a class="nav-link text-warning fw-bold" href="#" data-bs-toggle="modal" data-bs-target="#inzerentModal">
    <i class="bi bi-megaphone-fill me-1"></i>For Advertisers
  </a>
</li>
        <li class="nav-item">
          <a class="nav-link" href="/index.html">Map</a>
        </li>

         <li class="nav-item" id="messages-nav-item" style="display:none;">
          <a class="nav-link" href="/moje-zpravy.html">
            <i class="bi bi-envelope me-1"></i>My Messages
          </a>
        </li>
        
        <li class="nav-item" id="poptavky-nav-item" style="display:none;">
  <a class="nav-link" href="/poptavky.html">
    <i class="bi bi-briefcase-fill me-1"></i>Job Requests
  </a>
</li>

        <li class="nav-item">
          <a class="nav-link" href="/o-projektu.html">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/kontakt.html">Contact</a>
        </li>

<li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" href="#" id="langDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    üåê Language
  </a>
  <ul class="dropdown-menu" aria-labelledby="langDropdown">
            <li>
  <a class="dropdown-item" href="/index.html">
    <span class="fi fi-cz me-2"></span>ƒåesky
  </a>
</li>
<li>
  <a class="dropdown-item" href="/index_en.html">
    <span class="fi fi-gb me-2"></span>English
  </a>
</li>


<!--
<li>
  <a class="dropdown-item" href="/index_ua.html">
    <span class="fi fi-ua me-2"></span>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞
  </a>
</li>
-->


          </ul>
</li>
          
<li class="nav-item">

</li>
      </ul>
<button id="login-button" class="pilot-login-btn btn-sm user-action d-flex align-items-center justify-content-center px-3 py-2">
  <i class="bi bi-person-badge me-2"></i>
  <span id="login-toggle">Log in as a Pilot</span>
</button>
    </div>
  </div>
</nav>

  <div class="container py-4">
    <h1 class="text-center">
  <i class="bi bi-map-fill me-2" aria-hidden="true"></i>
  Drone Pilot Map in Czechia</h1>
    <p id="user-status" class="text-center fw-bold mb-3"></p>
<!-- Login buttons -->
<div id="pilot-login-wrapper" class="d-flex flex-wrap align-items-center gap-2 justify-content-center" >

  


<!-- Modal for advertisers -->
<div class="modal fade" id="inzerentModal" tabindex="-1" aria-labelledby="inzerentModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-warning">
      <div class="modal-header bg-warning">
        <h5 class="modal-title" id="inzerentModalLabel">
          <i class="bi bi-building me-2"></i>For Companies & Advertisers
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Looking for a pilot for filming, inspection, or mapping? Choose from verified pilots by region and specialization.</p>
      </div>
      <div class="modal-footer">
        <a href="/inzerent.html" class="btn btn-outline-warning">
          <i class="bi bi-person-badge-fill me-1"></i> Log in as Advertiser
        </a>
      </div>
    </div>
  </div>
</div>


  <span id="logged-info" class="fw-bold small"></span>
  <button id="edit-profile-btn" style="display:none;" class="pilot-login-btn w-100">
    <i class="bi bi-pencil-square me-1"></i>Edit
  </button>
</div>
    

    <section class="mb-5">
<p class="visually-hidden">
  Find verified drone pilots in Czechia. An interactive map of drone pilots ‚Äî filter by location, equipment, and specialization. Quick contact and direct connection with clients.
</p>
      <p><strong>Looking for a drone pilot near you?</strong> Or do you fly and want to be discovered?</p>
      <p>This map connects clients and pilots. Find a reliable pilot by location, equipment, or specialization ‚Äî or register yourself and get new flying and earning opportunities.</p>
      <ul>
  <li><strong>Fast matchmaking</strong> without unnecessary forms</li>
  <li><strong>Verified pilots</strong> with profile and contact</li>
  <li><strong>Extra income opportunity</strong> for every pilot</li>
</ul>
      <p><strong>Start by clicking a pilot on the map ‚Äî or log in and join!</strong></p>
    </section>

    <h2>
  <i class="bi bi-geo-alt-fill text-danger me-2" aria-hidden="true"></i>
  Pilots Listed on the Map
</h2>

    <p>Below you can see all available pilots. Click the icon to view their profile, equipment, and contact. Logged-in users also see details like specialization, drones, or travel radius.</p>

    <div id="login-modal-backdrop"></div>

    <!-- Login modal -->
    <div id="login-box" style="display: none; position: relative;">
<button type="button" class="btn-close close-btn" aria-label="Close"
        onclick="document.getElementById('login-box').style.display='none';"></button>
   <h3>Pilot Login</h3>


      <form id="login-form" onsubmit="pilotLogin(event)">
        <div class="mb-3">
          <label for="email" class="form-label">E-mail:</label>
          <input type="email" id="email" name="email" class="form-control" required />
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Password:</label>
          <input type="password" id="password" name="password" class="form-control" required />
        </div>
        <button type="submit" class="pilot-login-btn btn-sm user-action d-flex align-items-center justify-content-center px-3 py-2 w-100"><i class="bi bi-box-arrow-in-right me-2"></i>Sign in</button>
      </form>
      <p id="login-status" class="mt-3"></p>
      <a href="/register.html" class="link">Not registered yet ‚Äì I want to sign up</a>
      <a href="/forgot.html" class="link">Forgot password?</a>
    </div>
    
    <div id="map" class="mt-4"></div>

  </div>

  <!-- Leaflet & Cluster -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script -->
  <script>
    const map = L.map('map').setView([49.8, 15.5], 7);
const fakeNames = [
  "Speedy Ground Squirrel",
  "Flying Potato",
  "Dronislav Skywalker",
  "Turbo Reedbird",
  "Unmanned Emil",
  "Whistling Peacock",
  "Pilot Haluz",
  "Franti≈°ek Rotorcraft",
  "Left Joystick",
  "Captain Shadow",
  "Dr. Rotor",
  "Mr. Spinny",
  "Stewardess Landov√°",
  "Dive-bombing Franta",
  "Supersonic Hedgehog",
  "Flying ƒåenda",
  "Rotor Rose",
  "Rustling Fanda",
  "Safety B√©ƒèa",
  "Beacon of Clouds",
  "Drony Karel",
  "Stumbly Pilot",
  "Starter Stan",
  "Landing Pepa",
  "Helicopter Honza",
  "Navigator Nov√°k",
  "Sensor So≈àa",
  "Lord of Clouds",
  "Flying Lojza",
  "Camera Kamil",
  "Rotor R√≠≈°a",
  "Altimeter Va≈°ek",
  "Aerial Vojta",
  "Quiet Hummer",
  "Buzzing Dan",
  "Foggy Milda",
  "Optics Otakar",
  "Lost Signal",
  "Gimbal Master",
  "Antenna Aniƒçka",
  "Little Prop Vƒõrka",
  "Casual L√≠da",
  "Flyboy Felix",
  "Airy Fairy",
  "Navigational Norbert",
  "Blue Squadron",
  "Winged Karel",
  "Field Phantom",
  "Map-maker Mirek",
  "Dodging Kuba"
];


    
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      maxZoom: 18
    }).addTo(map);

    const markers = L.markerClusterGroup();
    const pilotCircles = [];
    fetch('/pilots')
      .then(res => res.json())
      .then(data => {
        data.forEach(p => {

        
  if (p.visible !== "ANO") return; // Hide invisible pilots

  if (p.latitude != null && p.longitude != null) {

            let circleOptions = {
      radius: 2000, // Default radius
      fillOpacity: 0.2, // Default opacity for Free
      color: p.available === "ANO" ? 'green' : 'gray',
      fillColor: p.available === "ANO" ? '#4CAF50' : '#CCCCCC',
      weight: 1
    };

    // Change for different account types
    if (p.type_account === "Free") {
      circleOptions.color = 'lightgreen';
      circleOptions.fillOpacity = 0.2;
    } else if (p.type_account === "Basic") {
      circleOptions.color = 'darkgreen';
      circleOptions.fillOpacity = 0.5;
    } else if (p.type_account === "Premium") {
  circleOptions.color = 'purple';         // Outline color
  circleOptions.fillColor = 'purple';     // Fill color
  circleOptions.fillOpacity = 0.8;        // Fill opacity
  circleOptions.radius = 10000;           // Larger radius than Free and Basic
  circleOptions.weight = 3;               // Stroke width
}

            const circle = L.circle([p.latitude, p.longitude], circleOptions)


            .bindPopup(() => {
  const loggedIn = localStorage.getItem("loggedEmail") || localStorage.getItem("inzerentEmail");
  const isAvailable = p.available === "ANO";
  const fakeName = fakeNames[Math.floor(Math.random() * fakeNames.length)];
  const hasBuildBadge = p.id && Number(p.id) <= 80;
const buildBadge = hasBuildBadge 
  ? `<img src="/icons/build50_v1.png" alt="Build 50" width="64" height="64" class="ms-2 align-middle" title="Build 50">`
  : "";
  // Optional: name with badge (for reuse)
const pilotNameWithBadge = `${p.name || ''}${buildBadge}`;
const fakeNameWithBadge  = `${fakeName}${buildBadge}`;
  // New: read consent from backend (prefer p.hasPublicConsent), handle also "t"/"f"
const hasPublicConsent = (() => {
  const v = (p.hasPublicConsent ?? p.granted ?? false);
  if (typeof v === 'boolean') return v;
  const s = String(v).trim().toLowerCase();
  return s === 'true' || s === 't' || s === '1' || s === 'ano' || s === 'yes';
})();

if (!hasPublicConsent) {
  return `
    <div class="pilot-card">
      <h3><i class="bi bi-person-circle me-1"></i>${fakeNameWithBadge}</h3>

      <div class="d-flex flex-wrap gap-2 mb-2">
        ${p.volunteer === 'ANO' ? `<span class="badge-volunteer">Volunteer</span>` : ''}
        <span class="badge-gdpr">No GDPR consent ‚Äì contact via administrator</span>
      </div>

      ${p.specialization ? `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specialization:</strong> ${p.specialization}</p>` : ''}
    </div>
  `;
}



 

  let html = `<div class="pilot-card">`;
 
  if (isAvailable && loggedIn) {
  if (p.type_account === "Free") {
      // Free account ‚Äì limited information
     html += `
  <div class="d-flex justify-content-between align-items-center mb-1">
    <h3 class="mb-0"><i class="bi bi-person-circle me-1"></i>${p.name}</h3>
    ${p.registrationnumber && p.registrationnumber.startsWith("CZE") && p.registrationnumber.length === 16 
      ? `<img src="/icons/approved_4.png" alt="Verified operator" width="60" class="me-2">` 
      : ''}
    ${p.id && Number(p.id) <= 80
      ? `<img src="/icons/build50_v1.png" alt="Build 50" width="64" height="64" class="ms-2 align-middle" title="Build 50">`
      : ''}
  </div>
`;
  
      if (p.volunteer === 'ANO') {
        html += `<div class="mb-2"><span class="badge-volunteer">Volunteer</span></div>`;
      }

      if (p.drones) html += `<p><i class="bi bi-drone me-1"></i><strong>Drones:</strong> ${p.drones}</p>`;
      if (p.specialization) html += `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specialization:</strong> ${p.specialization}</p>`;

      html += `</div>`;
    } else if (p.type_account === "Basic") {
  // Basic account ‚Äì more information
 html += `
  <div class="d-flex justify-content-between align-items-center mb-1">
    <h3 class="mb-0"><i class="bi bi-person-circle me-1"></i>${p.name}</h3>
    ${p.registrationnumber && p.registrationnumber.startsWith("CZE") && p.registrationnumber.length === 16 
      ? `<img src="/icons/approved_4.png" alt="Verified operator" width="60" class="me-2">` 
      : ''}
    ${p.id && Number(p.id) <= 80
      ? `<img src="/icons/build50_v1.png" alt="Build 50" width="64" height="64" class="ms-2 align-middle" title="Build 50">`
      : ''}
  </div>
`;
  
  
  
 if (p.volunteer === 'ANO') {
        html += `<div class="mb-2"><span class="badge-volunteer">Volunteer</span></div>`;
      }
  if (p.drones) html += `<p><i class="bi bi-drone me-1"></i><strong>Drones:</strong> ${p.drones}</p>`;
  if (p.note) html += `<p><i class="bi bi-chat-left-text me-1"></i><strong>About me:</strong> ${p.note}</p>`;
  if (p.travel) html += `<p><i class="bi bi-signpost me-1"></i><strong>Travel radius:</strong> ${p.travel}</p>`;
  if (p.licenses) html += `<p><i class="bi bi-award me-1"></i><strong>Licenses:</strong> ${p.licenses}</p>`;
  if (p.specialization) html += `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specialization:</strong> ${p.specialization}</p>`;

  // Button to contact the pilot
  html += `
    <div class="mt-3">
      <button class="pilot-login-btn btn-sm user-action d-flex align-items-center justify-content-center px-3 py-2 w-100" onclick="contactPilot('${p.email}')">
        ‚úâÔ∏è Message the Pilot
      </button>
    </div>
  `;
}
 else if (p.type_account === "Premium") {
      // Premium account ‚Äì all information
      html += `
  <div class="d-flex justify-content-between align-items-center mb-1">
    <h3 class="mb-0"><i class="bi bi-person-circle me-1"></i>${p.name}</h3>
    ${p.registrationnumber && p.registrationnumber.startsWith("CZE") && p.registrationnumber.length === 16 
      ? `<img src="/icons/approved_4.png" alt="Verified operator" width="60" class="me-2">` 
      : ''}
    ${p.id && Number(p.id) <= 80
      ? `<img src="/icons/build50_v1.png" alt="Build 50" width="64" height="64" class="ms-2 align-middle" title="Build 50">`
      : ''}
  </div>
`;
  
  
      if (p.volunteer === 'ANO') {
        html += `<div class="mb-2"><span class="badge-volunteer">Volunteer</span></div>`;
      }

      // Contacts for Premium accounts
      if (p.email) html += `<p><i class="bi bi-envelope-at me-1"></i><a href="mailto:${p.email}">${p.email}</a></p>`;
      if (p.phone) html += `<p><i class="bi bi-telephone-fill me-1"></i><a href="tel:${p.phone}">${p.phone}</a></p>`;

      html += `<p><i class="bi bi-drone me-1"></i><strong>Drones:</strong> ${p.drones}</p>`;
      if (p.specialization) html += `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specialization:</strong> ${p.specialization}</p>`;
      if (p.travel) html += `<p><i class="bi bi-signpost me-1"></i><strong>Travel radius:</strong> ${p.travel}</p>`;
      if (p.licenses) html += `<p><i class="bi bi-award me-1"></i><strong>Licenses:</strong> ${p.licenses}</p>`;
    }
  } else if (!isAvailable) {
    // Pilot is not available
    html += `
      <h3><i class="bi bi-person-circle me-1"></i>${fakeNameWithBadge}</h3>

      <br>
      ${p.volunteer === 'ANO' ? `<div class="mb-2"><span class="badge-volunteer">Volunteer</span></div>` : ''}
      <p class="text-danger"><i class="bi bi-exclamation-triangle-fill me-1"></i>This pilot is currently unavailable</p>
      ${p.specialization ? `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specialization:</strong> ${p.specialization}</p>` : ''}
    `;
  } else {
    // Not logged-in user
    html += `
      <h3><i class="bi bi-person-circle me-1"></i>${fakeNameWithBadge}</h3>
      
      <br>
      ${p.volunteer === 'ANO' ? `<div class="mb-2"><span class="badge-volunteer">Volunteer</span></div>` : ''}
      <p><i class="bi bi-envelope-at me-1"></i><span class="text-muted">[e-mail after login]</span></p>
      ${p.phone ? `<p><i class="bi bi-telephone-fill me-1"></i><span class="text-muted">[phone hidden]</span></p>` : ''}
      ${p.specialization ? `<p><i class="bi bi-puzzle-fill me-1"></i><strong>Specialization:</strong> ${p.specialization}</p>` : ''}
      ${p.travel ? `<p><i class="bi bi-signpost me-1"></i><strong>Travel radius:</strong> ${p.travel}</p>` : ''}
      <p class="text-muted"><em>Log in as an advertiser to see more details and connect.</em></p>
    `;
  }

  html += `</div>`;
  return html;
})

            markers.addLayer(circle);
            pilotCircles.push(circle);
          }
        });
        map.addLayer(markers);
        if (markers.getBounds().isValid()) {
          map.fitBounds(markers.getBounds(), { padding: [30, 30] });
        }
      });

    map.on('zoomend', () => {
  const zoom = map.getZoom();
  pilotCircles.forEach(circle => {
    const maxZoom = 14;
    const minZoom = 7;
    const minRadius = 100;
    const maxRadius = 2000;

    // Radius settings for account types
    let accountMinRadius = minRadius;
    let accountMaxRadius = maxRadius;

    if (circle.options.fillColor === 'darkgreen') { // Basic account (dark green)
      accountMinRadius = 100;
      accountMaxRadius = 4000;
    } else if (circle.options.fillColor === 'purple') { // Premium account (purple)
      accountMinRadius = 100;
      accountMaxRadius = 10000;
    }

    const ratio = (zoom - minZoom) / (maxZoom - minZoom);
    const radius = Math.max(accountMinRadius, accountMaxRadius - (accountMaxRadius - accountMinRadius) * ratio);
    circle.setRadius(radius);

    const opacity = 0.2 + 0.2 * (1 - ratio);
    circle.setStyle({ fillOpacity: opacity });
  });
});

    document.addEventListener("DOMContentLoaded", () => {
      const loginBox = document.getElementById("login-box");
      const toggle = document.getElementById("login-toggle");
      const status = document.getElementById("user-status");
      const loggedEmail = localStorage.getItem("loggedEmail");
      const editBtn = document.getElementById("edit-profile-btn");
      const messagesNavItem = document.getElementById("messages-nav-item");

const inzerentNavItem = document.getElementById("inzerent-nav-item");
  if (!loggedEmail && inzerentNavItem) {
  inzerentNavItem.style.display = "block";
}

if (loggedEmail) {
  loginBox.style.display = "none";
  editBtn.style.display = "inline-block";
  toggle.textContent = "Log out";
  status.textContent = "Logged in as: " + loggedEmail;
  
  // Show "My Messages" for logged-in users
  const messagesNavItem = document.getElementById("messages-nav-item");
  if (messagesNavItem) {
    messagesNavItem.style.display = "block";
  }

  // Show "Job Requests" only for Basic/Premium
  const poptavkyNavItem = document.getElementById("poptavky-nav-item");
  if (poptavkyNavItem && loggedEmail) {
    fetch('/get-my-pilot', { credentials: 'include' })
      .then(r => r.ok ? r.json() : null)
      .then(me => {
        const t = (me?.type_account || '').toLowerCase();
        if (t === 'basic' || t === 'premium') {
          poptavkyNavItem.style.display = "block";
        } else {
          poptavkyNavItem.style.display = "none";
        }
      })
      .catch(() => { poptavkyNavItem.style.display = "none"; });
  }

  toggle.addEventListener("click", () => {
    localStorage.removeItem("loggedEmail");
    window.location.reload();
  });
} else {
  toggle.addEventListener("click", () => {
    loginBox.style.display = loginBox.style.display === "none" ? "block" : "none";
  });
}

if (loggedEmail && editBtn) {
  editBtn.style.display = "inline-block";
  editBtn.addEventListener("click", () => {
    window.location.href = "/account.html?email=" + encodeURIComponent(loggedEmail);
  });
}


      window.pilotLogin = function(event) {
        event.preventDefault();
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const statusBox = document.getElementById("login-status");

        fetch("/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        })
        .then(res => {
          if (!res.ok) throw new Error("Invalid e-mail or password.");
          return res.text();
        })
        .then(msg => {
          localStorage.setItem("loggedEmail", email);
          statusBox.style.color = "green";
          statusBox.textContent = msg;
          window.location.href = "/account.html?email=" + encodeURIComponent(email);
        })
        .catch(err => {
          statusBox.style.color = "red";
          statusBox.textContent = err.message;
        });
      };
    });

function contactPilot(pilotEmail) {
  const currentUserEmail = localStorage.getItem('loggedEmail') || localStorage.getItem('inzerentEmail');
  const currentUserType  = localStorage.getItem('loggedEmail') ? 'pilot' : 'inzerent';
  
  if (!currentUserEmail) {
    alert("You must be logged in to contact pilots.");
    return;
  }

  Promise.all([
    fetch(`/get-user-id?email=${encodeURIComponent(currentUserEmail)}&type=${currentUserType}`).then(res => res.json()),
    fetch(`/get-user-id?email=${encodeURIComponent(pilotEmail)}&type=pilot`).then(res => res.json())
  ])
  .then(([currentUser, partner]) => {
    return fetch('/create-conversation', {   // correct endpoint
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        pilotEmail: pilotEmail,
        advertiserEmail: currentUserType === 'inzerent' ? currentUserEmail : null
      })
    }).then(res => res.json());
  })
  .then(({ success, conversationId }) => {   // server returns conversationId
    if (!success) throw new Error("Failed to create conversation.");
    window.location.href = `/chat.html?conversationId=${conversationId}`;
  })
  .catch(err => {
    console.error("Error creating conversation:", err);
    alert("Please log in as an advertiser to start a conversation.");
  });
}document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("sendContactMessage").addEventListener("click", () => {
    const pilotEmail = document.getElementById("contactPilotEmail").value;
    const message = document.getElementById("contactMessage").value.trim();

    if (!message) {
      alert("Please write a message.");
      return;
    }

    fetch('/contact-pilot', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ to: pilotEmail, message })
    })
    .then(res => {
      if (!res.ok) throw new Error("Message could not be sent.");
      return res.text();
    })
    .then(response => {
      alert(response);
      bootstrap.Modal.getInstance(document.getElementById('contactPilotModal')).hide();
    })
    .catch(err => alert("‚ùå Error: " + err.message));
  });
});
  </script>
<script>

  const advertiserEmail = localStorage.getItem("inzerentEmail");

  if (advertiserEmail) {
    const banner = document.createElement("div");
    banner.className = "alert alert-warning text-center m-3 d-flex justify-content-center align-items-center";
    banner.innerHTML = `
      <div>
        <strong>Advertiser logged in:</strong> ${advertiserEmail}
      </div>
    `;

    const logoutBtn = document.createElement("button");
    logoutBtn.className = "btn btn-sm btn-outline-dark ms-3";
    logoutBtn.textContent = "Log out";
    logoutBtn.onclick = () => {
      localStorage.removeItem("inzerentEmail");
      window.location.reload();
    };

    banner.appendChild(logoutBtn);
    document.body.prepend(banner);
  }


fetch(`/get-conversations?pilotEmail=${encodeURIComponent(pilotEmail)}&inzerentEmail=${encodeURIComponent(advertiserEmail)}`)

        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("conversations-list");
          container.innerHTML = "";

          if (data.success && data.conversations.length > 0) {
            data.conversations.forEach(conv => {
              const conversationCard = document.createElement("a");
              conversationCard.href = `/chat.html?conversationId=${conv.id}&pilotEmail=${encodeURIComponent(pilotEmail)}&inzerentEmail=${encodeURIComponent(conv.advertiser_email)}`;
              conversationCard.className = `conversation-card d-block p-3 border-bottom ${conv.unread ? 'unread' : ''}`;
              
              conversationCard.innerHTML = `
                <div class="d-flex justify-content-between">
                  <div>
                    <h5 class="mb-1">${conv.advertiser_name || conv.advertiser_email}</h5>
                    <p class="mb-1 last-message">${conv.last_message || 'No messages yet'}</p>
                  </div>
                  <div class="text-end">
                    <span class="time-ago">${formatTimeAgo(conv.last_message_time)}</span>
                    ${conv.unread ? '<span class="badge bg-primary ms-2">New</span>' : ''}
                  </div>
                </div>
              `;
              container.appendChild(conversationCard);
            });
          } else {
            container.innerHTML = `
              <div class="text-center py-5">
                <i class="bi bi-envelope-open display-5 text-muted"></i>
                <p class="mt-3">You have no messages yet</p>
                <a href="/index.html" class="btn btn-primary mt-2">Find jobs</a>
              </div>
            `;
          }
        })
        .catch(err => {
          console.error("Failed to load conversations:", err);
          document.getElementById("conversations-list").innerHTML = `
            <div class="text-center py-5 text-danger">
              <i class="bi bi-exclamation-triangle display-5"></i>
              <p class="mt-3">Could not load conversations</p>
              <button onclick="window.location.reload()" class="btn btn-outline-primary mt-2">
                <i class="bi bi-arrow-repeat"></i> Try again
              </button>
            </div>
          `;
        });

      // Helper function to format time ago
      function formatTimeAgo(timestamp) {
        if (!timestamp) return "";
        const now = new Date();
        const msgDate = new Date(timestamp);
        const diff = Math.floor((now - msgDate) / 1000); // difference in seconds
        
        if (diff < 60) return "just now";
        if (diff < 3600) return `${Math.floor(diff/60)} min`;
        if (diff < 86400) return `${Math.floor(diff/3600)} h`;
        return `${Math.floor(diff/86400)} d`;
      }
    });
</script>



<script>
  document.addEventListener("DOMContentLoaded", () => {
    const inzerentEmail = localStorage.getItem("inzerentEmail");
    const loginWrapper = document.getElementById("pilot-login-wrapper");

    if (inzerentEmail && loginWrapper) {
      loginWrapper.style.display = "none";
    }
  });
</script>



<div class="modal fade" id="contactPilotModal" tabindex="-1" aria-labelledby="contactPilotModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="contactPilotModalLabel">Message the Pilot</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="contactMessage" class="form-label">Your message</label>
          <textarea id="contactMessage" class="form-control" rows="5" placeholder="Write your message here..."></textarea>
        </div>
        <input type="hidden" id="contactPilotEmail">
      </div>

<!-- Modal for public contact consent -->
<div class="modal fade" id="publicContactConsentModal" tabindex="-1" aria-labelledby="publicContactConsentLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content border-warning">
      <div class="modal-header bg-warning">
        <h5 class="modal-title" id="publicContactConsentLabel">Consent to Publicly Show Contacts</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        I agree that my e-mail and phone number may be publicly displayed on my profile.
        <div class="form-check mt-3">
          <input class="form-check-input" type="checkbox" id="premiumConsentCheck">
          <label class="form-check-label" for="premiumConsentCheck">
            I agree to publish my contact details
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-warning" id="confirmPremiumConsent">Confirm</button>
      </div>
    </div>
  </div>
</div>


<script>
document.getElementById('confirmPremiumConsent').addEventListener('click', function() {
  if (!document.getElementById('premiumConsentCheck').checked) {
    alert("You must confirm the consent to publish contacts.");
    return;
  }

  fetch('/save-consent', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      consent_type: 'public_contact',
      consent_text: 'Consent to display e-mail and phone number on the public profile.',
      timestamp: new Date().toISOString()
    })
  })
  .then(res => {
    if (!res.ok) throw new Error("Failed to save consent.");
    alert("Consent saved. Your contacts will now be visible.");
    location.reload();
  })
  .catch(err => alert(err.message));
});
</script>

      <div class="modal-footer">
        <button type="button" class="pilot-login-btn btn-sm user-action d-flex align-items-center justify-content-center px-3 py-2 w-100" data-bs-dismiss="modal">Close</button>
        <button type="button" class="pilot-login-btn btn-sm user-action d-flex align-items-center justify-content-center px-3 py-2 w-100" id="sendContactMessage">Send</button>
      </div>
    </div>
  </div>
</div>

<footer class="footer mt-5 pt-4 pb-4 bg-light border-top">
  <div class="container">
    <div class="row gy-3 justify-content-between">
      
      <!-- Logo & description -->
      <div class="col-md-4">
        <a href="/" class="d-flex align-items-center mb-2 text-decoration-none text-dark">
          <img src="/icons/logo.png" alt="NajdiPilota logo" height="40" class="me-2" />
          <span class="fw-bold fs-5">NajdiPilota.cz</span>
        </a>
        <p class="small text-muted">We connect clients with verified drone pilots across the Czech Republic. Quick, direct connection without middlemen.</p>
      </div>

      <!-- Navigation -->
      <div display="no" class="col-md-2">
        <h6 class="fw-bold">Navigation</h6>
        <ul class="list-unstyled">
          <li><a href="/index.html" class="text-decoration-none text-muted">Pilot Map</a></li>
          <li><a href="/o-projektu.html" class="text-decoration-none text-muted">About</a></li>
          <li><a href="/kontakt.html" class="text-decoration-none text-muted">Contact</a></li>
        <li><a href="/v-procesu.html" class="text-decoration-none text-muted">Blog</a></li>
        </ul>
      </div>

      <!-- Legal / Info -->
      <div class="col-md-3">
        <h6 class="fw-bold">Information</h6>
        <ul class="list-unstyled">
          <li><a href="/gdpr.html" class="text-decoration-none text-muted">Personal Data Processing</a></li>
          
          <li><a href="mailto:dronadmin@seznam.cz?subject=Website bug report" class="text-decoration-none text-muted">Report an issue</a></li>
        </ul>
      </div>

      <!-- Operator -->
      <div class="col-md-3">
        <h6 class="fw-bold">Operator</h6>
        <p class="small text-muted mb-1">Ing. Bohuslav Vladyka<br>Company ID (IƒåO): 08578591<br>Prague, Czech Republic</p>
        <p class="small text-muted mb-0">üìß <a href="mailto:dronadmin@seznam.cz" class="text-muted">dronadmin@seznam.cz</a></p>
      </div>

    </div>

    <hr class="my-4">

    <div class="d-flex justify-content-between align-items-center small text-muted">
      <span>&copy; <span id="year"></span> NajdiPilota.cz</span>
      <div>
        <a href="/v-procesu.html" class="text-muted me-3"><i class="bi bi-facebook"></i></a>
        <a href="/v-procesu.html" class="text-muted me-3"><i class="bi bi-instagram"></i></a>
        <a href="/v-procesu.html" class="text-muted"><i class="bi bi-linkedin"></i></a>
      </div>
    </div>
  </div>
</footer>

<script>
  // Insert current year into copyright
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("year").textContent = new Date().getFullYear();
  });
</script>

<script>
  // If the page is not intended for advertisers, log them out
  document.addEventListener("DOMContentLoaded", () => {
    if (localStorage.getItem("inzerentEmail")) {
      localStorage.removeItem("inzerentEmail");
    }
  });
</script>

<script>
  // Automatically add 'active' class for current page in navbar
  document.addEventListener("DOMContentLoaded", () => {
    const currentPage = window.location.pathname;
    const navLinks = document.querySelectorAll('.navbar-nav .nav-item .nav-link');
    
    navLinks.forEach(link => {
      if (link.getAttribute('href') === currentPage) {
        link.parentElement.classList.add('active');
      }
    });
  });
</script>

<script>
  // badge in top navigation (index.html)
  function renderUnreadBadgeIntoNav(count) {
    const li = document.getElementById('messages-nav-item');
    if (!li) return;
    const a = li.querySelector('a.nav-link');
    if (!a) return;

    let badge = a.querySelector('#unread-badge');
    if (!badge) {
      badge = document.createElement('span');
      badge.id = 'unread-badge';
      badge.className = 'badge rounded-pill bg-danger ms-2';
      a.appendChild(badge);
    }
    if (count > 0) {
      badge.textContent = String(count);
      badge.style.display = '';
    } else {
      badge.style.display = 'none';
    }
  }

  async function refreshUnreadNavBadge() {
    const email = localStorage.getItem('loggedEmail');
    if (!email) return;
    try {
      const r = await fetch('/unread-count?pilotEmail=' + encodeURIComponent(email));
      const data = await r.json();
      renderUnreadBadgeIntoNav(data.count || 0);
    } catch {}
  }

  document.addEventListener('DOMContentLoaded', () => {
    const loggedEmail = localStorage.getItem('loggedEmail');
    if (loggedEmail) {
      // only for logged-in pilots
      refreshUnreadNavBadge();
      setInterval(refreshUnreadNavBadge, 60000); // refresh every minute
    }
  });
</script>




</body>
</html>
